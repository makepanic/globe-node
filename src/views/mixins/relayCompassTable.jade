mixin relayCompassTable(relays, notDisplayed)
    table.relay-summary-list.datatable
        thead
            tr
                th
                th.align-left
                    a(href='search-compass?#{format.searchQuery(requestQuery, "nickname")}', title='sort by nickname')
                        | Nickname
                        if requestQuery.sortBy === 'nickname'
                            != format.sortIndicator('alpha', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "consensus_weight_fraction")}', title='sort by consensus weights')
                        | Consensus Weights
                        if requestQuery.sortBy === 'consensus_weight_fraction'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "advertised_bandwidth_fraction")}', title='sort by advertised bandwidth')
                        | Advertised Bandwidth
                        if requestQuery.sortBy === 'advertised_bandwidth_fraction'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "guard_probability")}', title='sort by guard probability')
                        | Guard Prob.
                        if requestQuery.sortBy === 'guard_probability'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "middle_probability")}', title='sort by middle probability')
                        | Middle Prob.
                        if requestQuery.sortBy === 'middle_probability'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "exit_probability")}', title='sort by exit probability')
                        | Exit Prob.
                        if requestQuery.sortBy === 'exit_probability'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "country")}', title='sort by country')
                        | Country
                        if requestQuery.sortBy === 'country'
                            != format.sortIndicator('alpha', normRequestQuery.sortAsc)
                th.align-left
                    a(href='search-compass?#{format.searchQuery(requestQuery, "tor")}', title='sort by Tor version')
                        | Tor version
                        if requestQuery.sortBy === 'tor'
                            != format.sortIndicator('numeric', normRequestQuery.sortAsc)
                th
                    a(href='search-compass?#{format.searchQuery(requestQuery, "osString")}', title='sort by operating system')
                        | OS
                        if requestQuery.sortBy === 'osString'
                            != format.sortIndicator('alpha', normRequestQuery.sortAsc)
                th
                    i.fa.fa-sign-out(title='Exit')
                th
                    i.fa.fa-shield(title='Guard')
        if relays.length
            tbody
                each relay in relays
                    - relayUrl = '/relay/' + relay.hashed_fingerprint;
                    tr
                        td
                            a(href=relayUrl)
                                if relay.running
                                    .d3-col.block-2(title='This relay is listed in the current Tor directory.')
                                else
                                    .d3-col.block-3(title="This relay isn't listed in the current Tor directory.")
                        td
                            a.nick(href=relayUrl) #{relay.nickname}
                        td.align-center
                            a(href=relayUrl) #{format.percent(relay.consensus_weight_fraction, 4)}
                        td.align-center
                            a(href=relayUrl) #{format.percent(relay.advertised_bandwidth_fraction, 4)}
                                | (#{format.bandwidth(relay.advertised_bandwidth)})
                        td.align-center
                            a(href=relayUrl) #{format.percent(relay.guard_probability, 4)}
                        td.align-center
                            a(href=relayUrl) #{format.percent(relay.middle_probability, 4)}
                        td.align-center
                            a(href=relayUrl) #{format.percent(relay.exit_probability, 4)}
                        td.align-center
                            a(href=relayUrl) !{format.flaggify(relay.country, 4)}
                        td.align-left
                            a(href=relayUrl, title='using #{relay.client}') #{relay.tor}
                        td.align-center
                            if relay.osString
                                a(href=relayUrl, title=relay.meta ? relay.meta : undefined) #{relay.osString}
                        td.align-center
                            a(href=relayUrl)
                                i(class="fa fa-#{~relay.flags.indexOf('Exit') ? 'check' : 'minus'}")
                        td.align-center
                            a(href=relayUrl)
                                i(class="fa fa-#{~relay.flags.indexOf('Guard') ? 'check' : 'minus'}")
            tfoot
                tr
                    td
                    td
                        p #{notDisplayed.number} other relays
                    td.align-center
                        p #{format.percent(notDisplayed.consensus_weight_fraction, 4)}
                    td.align-center
                        p #{format.percent(notDisplayed.advertised_bandwidth_fraction, 4)}
                    td.align-center
                        p #{format.percent(notDisplayed.guard_probability, 4)}
                    td.align-center
                        p #{format.percent(notDisplayed.middle_probability, 4)}
                    td.align-center
                        p #{format.percent(notDisplayed.exit_probability, 4)}
        else
            tbody
                tr
                    td(colspan='12', class='empty no-a') No relays found :(
