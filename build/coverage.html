<!DOCTYPE html><html><head><title>Coverage</title><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
jQuery(document).ready(function() {
  jQuery(['partial', 'miss']).each(function(i, clss) {
    var $els = jQuery('.'+clss);
    $els.each(function(index, item) {
      var $this = jQuery(item).attr('id', clss + index);
      if (index < $els.length - 1) {
        $this.find('.action').append(
          jQuery('<a>').attr('href', '#' + clss + (index + 1))
            .text('next')
        );
      }
    });
  });
  jQuery(window).on('hashchange', function (e) {
    if (!jQuery(window.location.hash).attr('tabindex')) {
      jQuery(window.location.hash).attr('tabindex', '-1').focus();
    }
  })
});
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 12px;
  margin-bottom: 0;
  font-weight: 200;
  letter-spacing: 1px;
}

a {
  color: #8A6343;
  font-weight: bold;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 60px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .9;
  padding-right: 2px;
  font-weight: normal;
}

#menu li .basename {
  opacity: 1;
  font-weight: bold;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats {
  font-size: 1.3em;
}

.stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.stats div {
  float: left;
  padding: 0 5px;
}

.stats::after {
  display: block;
  content: '';
  clear: both;
}

.stats .sloc::after {
  color: #b6b6b6;
}

.stats .percentage::after {
  color: #b6b6b6;
}

.stats .hits,
.stats .misses {
  display: none;
}

.high {
  color: #3375B6;
}
#menu .high {
  color: #FFF;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

.file {
    margin-top: 15px;
    width:80%;
    padding-left:1%;
    padding-right:1%;
    border: 1px solid #eee;
    border-radius:3px;
}

table {
  width:100%;
  margin-top: 0px;
  border-collapse: collapse;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

div.table {
  border: 1px solid #cbcbcb;
  margin-top: 10px;
  width: 100%;
  -webkit-border-radius: 7px;
  -moz-border-radius: 7px;
  border-radius: 7px;
  overflow:hidden;
}

table th {
  border-bottom: #a3a3a3 1px solid;
  border-right: #a3a3a3 1px solid;
  border-collapse: separate;
  font-size: 12px;
}

table th:last-child {
  border-right:none;
}

table td.line,
table td.hits,
table td.statements {
  color: rgb(0,0,0);
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  border-left: #a3a3a3 1px solid;
  border-right: #a3a3a3 1px solid;
  border-collapse: separate;
}

table td.hits,
table td.statements {
  width: 10px;
  padding: 2px 5px;
}

table td.hits {
  background: #f0f0f0;  
}

tr.miss td.line,
tr.miss td.hits,
tr.miss td.statements {
  background: rgba(107, 0 ,1, 0.75);
}

tr.miss td {
  background: rgba(107, 0 ,1, 0.75);
  color: #fff;
}
tr.partial td.line,
tr.partial td.hits,
tr.partial td.statements {
  background: #fcf8e9;
}

tr.partial td {
  background: #fcf8e9;
  color: #000;
}

tr.partial td.source span.statement.notok {
  padding: 3px;
  margin: 3px;
  background: rgba(107, 0 ,1, 0.75);
  color: #fff;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

.miss .action a {
  color: #fff;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }

.offscreen {
    border: 0;
    clip: rect(0 0 0 0);
    clip: rect(0, 0, 0, 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    width: 1px;
    position: absolute;
}

</style></head><body><div id="menu" role="navigation"><li><a href="#overview">overview</a></li><li><span class="cov high">100</span><a href="#src/lib/util/calculate-uptime.js"><span class="dirname">src/lib/util/</span><span class="basename">calculate-uptime.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/utc-diff.js"><span class="dirname">src/lib/util/</span><span class="basename">utc-diff.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/country-flag.js"><span class="dirname">src/lib/util/</span><span class="basename">country-flag.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/static.js"><span class="dirname">src/lib/</span><span class="basename">static.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/global-data.js"><span class="dirname">src/lib/</span><span class="basename">global-data.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/rsplit.js"><span class="dirname">src/lib/util/</span><span class="basename">rsplit.js</span></a></li><li><span class="cov medium">74</span><a href="#src/lib/db/connection.js"><span class="dirname">src/lib/db/</span><span class="basename">connection.js</span></a></li><li><span class="cov high">83</span><a href="#src/lib/onionoo/util/get-JSON.js"><span class="dirname">src/lib/onionoo/util/</span><span class="basename">get-JSON.js</span></a></li><li><span class="cov high">96</span><a href="#src/lib/util/parse-platform.js"><span class="dirname">src/lib/util/</span><span class="basename">parse-platform.js</span></a></li><li><span class="cov high">85</span><a href="#src/lib/db/onionoo-mongo/filter.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">filter.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/get-sort-type.js"><span class="dirname">src/lib/util/</span><span class="basename">get-sort-type.js</span></a></li><li><span class="cov high">82</span><a href="#src/lib/db/onionoo-mongo/process-filter-results.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">process-filter-results.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/db/onionoo-mongo/create-mongo-filter.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">create-mongo-filter.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/db/onionoo-mongo/speeds.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">speeds.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/db/filters/exit-speed.js"><span class="dirname">src/lib/db/filters/</span><span class="basename">exit-speed.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/db/filters/same-network.js"><span class="dirname">src/lib/db/filters/</span><span class="basename">same-network.js</span></a></li><li><span class="cov high">95</span><a href="#src/lib/util/create-sort-fn.js"><span class="dirname">src/lib/util/</span><span class="basename">create-sort-fn.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/compare-version.js"><span class="dirname">src/lib/util/</span><span class="basename">compare-version.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/extract-version.js"><span class="dirname">src/lib/util/</span><span class="basename">extract-version.js</span></a></li><li><span class="cov high">75</span><a href="#src/lib/db/onionoo-mongo/group.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">group.js</span></a></li><li><span class="cov high">81</span><a href="#src/lib/db/onionoo-mongo/process-group-results.js"><span class="dirname">src/lib/db/onionoo-mongo/</span><span class="basename">process-group-results.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/count-array-uniques.js"><span class="dirname">src/lib/util/</span><span class="basename">count-array-uniques.js</span></a></li><li><span class="cov high">94</span><a href="#src/lib/util/formatter.js"><span class="dirname">src/lib/util/</span><span class="basename">formatter.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/errors.js"><span class="dirname">src/lib/</span><span class="basename">errors.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/onionoo/errors.js"><span class="dirname">src/lib/onionoo/</span><span class="basename">errors.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/onionoo/util/is-fingerprint.js"><span class="dirname">src/lib/onionoo/util/</span><span class="basename">is-fingerprint.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/middleware/feature-flags.js"><span class="dirname">src/lib/middleware/</span><span class="basename">feature-flags.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/middleware/handle404.js"><span class="dirname">src/lib/middleware/</span><span class="basename">handle404.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/middleware/normalize-query.js"><span class="dirname">src/lib/middleware/</span><span class="basename">normalize-query.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/middleware/render-if.js"><span class="dirname">src/lib/middleware/</span><span class="basename">render-if.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/onionoo/util/hash-fingerprint.js"><span class="dirname">src/lib/onionoo/util/</span><span class="basename">hash-fingerprint.js</span></a></li><li><span class="cov high">100</span><a href="#src/lib/util/handle-sort-undefined.js"><span class="dirname">src/lib/util/</span><span class="basename">handle-sort-undefined.js</span></a></li></div><div id="coverage" role="main"><h1 id="overview">Coverage</h1><div id="stats" class="stats high"><div class="percentage">89% line coverage</div><div class="statements">89% statement coverage</div><div class="blocks">77% block coverage</div><div class="sloc">979 SLOC</div><div class="hits"></div><div class="misses"></div></div><div id="files"><div class="file"><h2 id="src/lib/util/calculate-uptime.js">src/lib/util/calculate-uptime.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">23 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var utcDiff = require('./utc-diff'),
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(value, type){
    // if not a valid value return empty data</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!(_.isString(value) &amp;&amp; value.length === 19)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        return [];</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    var beforeLabel = '&lt;span&gt;',
        afterLabel = '&lt;/span&gt;';</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    var diff = utcDiff(value),
        units = [diff.d, diff.h, diff.m, diff.s],</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        shortVersion = type === 'short',</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        pluralize = !shortVersion,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        labels = shortVersion ? ['d', 'h', 'm', 's'] : ['day', 'hour', 'minute', 'second'],</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        uptimeArray = [];</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    units.every(function(unit, index){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        var isDone = false,
            label = labels[index];</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        if(unit &gt; 0) {</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // push unit with label to result array</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">            uptimeArray.push(unit + beforeLabel + (pluralize &amp;&amp; unit &gt; 1 ? label + 's' : label) + afterLabel);</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">            if(uptimeArray.length &gt; 1) {</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                // stop if more than 2 time values exist</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                isDone = true;</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">27</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        return !isDone;</span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">29</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    return uptimeArray;</span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/utc-diff.js">src/lib/util/utc-diff.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">15 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var moment = require('moment').utc;</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(value){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    var momentDate = moment(value, 'YYYY-MM-DD HH:mm:ss'),
        diff,
    // default result
        result = {},
        fl = Math.floor;</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (momentDate.isValid()) {</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        diff = moment().diff(momentDate);</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.s = Math.round(diff / 1000);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.m = fl(result.s / 60);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.h = fl(result.m / 60);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.d = fl(result.h / 24);</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.s %= 60;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.m %= 60;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        result.h %= 24;</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    return result;</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/country-flag.js">src/lib/util/country-flag.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">9 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var constants = require('../static');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(value){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">13</td><td class="statements">100%</td><td class="source"><span class="statement ">    var fullCountry = '';</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">13</td><td class="statements">100%</td><td class="source"><span class="statement ">    if(constants.countries.hasOwnProperty(value)){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        fullCountry = constants.countries[value];</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }else{</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        fullCountry = constants.messages.dataEmpty;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        value = 'empty';</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">13</td><td class="statements">100%</td><td class="source"><span class="statement ">    return '&lt;span title=&quot;' + fullCountry + '&quot; data-tooltip class=&quot;country-flag ' + value + '_png&quot;&gt;&lt;/span&gt;';</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/static.js">src/lib/static.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">0% block coverage</div><div class="sloc">9 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.numbers = {
    maxSearchResults: 50,

    // for tab sorting
    '3_days': 1,
    '1_week': 2,
    '1_month': 3,
    '3_months': 4,
    '1_year': 5,
    '5_years': 6
};</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.messages = {
    ETIMEDOUT: 'A request to the &lt;a href=&quot;https://www.torproject.org/projects/onionoo.html.en&quot;&gt;Onionoo-API&lt;/a&gt; timed out. If this continues to happen, send me a mail at &quot;me &amp;lt;at&amp;gt; rndm &amp;lt;dot&amp;gt; de&quot;',

    dataEmpty: 'n/a',
    detailsNotFound: 'No details found.',

    // from atlas error message
    invalidSearchTerm: 'The API replied with an error to your query. This probably means that you did not properly format your query.',</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    specifyYourSearch: 'To avoid too many requests, we limit our results to ' + exports.numbers.maxSearchResults + ' items. If you want better results, try to use a search word or apply some filters.',</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.countries = {
    'ad' : 'Andorra',
    'ae' : 'United Arab Emirates',
    'af' : 'Afghanistan',
    'ag' : 'Antigua and Barbuda',
    'ai' : 'Anguilla',
    'al' : 'Albania',
    'am' : 'Armenia',
    'an' : 'Netherlands Antilles',
    'ao' : 'Angola',
    'aq' : 'Antarctica',
    'ar' : 'Argentina',
    'as' : 'American Samoa',
    'at' : 'Austria',
    'au' : 'Australia',
    'aw' : 'Aruba',
    'ax' : 'Aland Islands',
    'az' : 'Azerbaijan',
    'ba' : 'Bosnia and Herzegovina',
    'bb' : 'Barbados',
    'bd' : 'Bangladesh',
    'be' : 'Belgium',
    'bf' : 'Burkina Faso',
    'bg' : 'Bulgaria',
    'bh' : 'Bahrain',
    'bi' : 'Burundi',
    'bj' : 'Benin',
    'bl' : 'Saint Bartelemey',
    'bm' : 'Bermuda',
    'bn' : 'Brunei',
    'bo' : 'Bolivia',
    'br' : 'Brazil',
    'bs' : 'Bahamas',
    'bt' : 'Bhutan',
    'bv' : 'Bouvet Island',
    'bw' : 'Botswana',
    'by' : 'Belarus',
    'bz' : 'Belize',
    'ca' : 'Canada',
    'cc' : 'Cocos (Keeling) Islands',
    'cd' : 'Democratic Republic of the Congo',
    'cf' : 'Central African Republic',
    'cg' : 'Congo',
    'ch' : 'Switzerland',
    'ci' : 'Côte d Ivoire',
    'ck' : 'Cook Islands',
    'cl' : 'Chile',
    'cm' : 'Cameroon',
    'cn' : 'China',
    'co' : 'Colombia',
    'cr' : 'Costa Rica',
    'cu' : 'Cuba',
    'cv' : 'Cape Verde',
    'cx' : 'Christmas Island',
    'cy' : 'Cyprus',
    'cz' : 'Czech Republic',
    'de' : 'Germany',
    'dj' : 'Djibouti',
    'dk' : 'Denmark',
    'dm' : 'Dominica',
    'do' : 'Dominican Republic',
    'dz' : 'Algeria',
    'ec' : 'Ecuador',
    'ee' : 'Estonia',
    'eg' : 'Egypt',
    'eh' : 'Western Sahara',
    'er' : 'Eritrea',
    'es' : 'Spain',
    'et' : 'Ethiopia',
    'fi' : 'Finland',
    'fj' : 'Fiji',
    'fk' : 'Falkland Islands (Malvinas)',
    'fm' : 'Federated States of Micronesia',
    'fo' : 'Faroe Islands',
    'fr' : 'France',
    'fx' : 'Metropolitan France',
    'ga' : 'Gabon',
    'gb' : 'United Kingdom',
    'gd' : 'Grenada',
    'ge' : 'Georgia',
    'gf' : 'French Guiana',
    'gg' : 'Guernsey',
    'gh' : 'Ghana',
    'gi' : 'Gibraltar',
    'gl' : 'Greenland',
    'gm' : 'Gambia',
    'gn' : 'Guinea',
    'gp' : 'Guadeloupe',
    'gq' : 'Equatorial Guinea',
    'gr' : 'Greece',
    'gs' : 'South Georgia and the South Sandwich Islands',
    'gt' : 'Guatemala',
    'gu' : 'Guam',
    'gw' : 'Guinea-Bissau',
    'gy' : 'Guyana',
    'hk' : 'Hong Kong',
    'hm' : 'Heard Island and McDonald Islands',
    'hn' : 'Honduras',
    'hr' : 'Croatia',
    'ht' : 'Haiti',
    'hu' : 'Hungary',
    'id' : 'Indonesia',
    'ie' : 'Ireland',
    'il' : 'Israel',
    'im' : 'Isle of Man',
    'in' : 'India',
    'io' : 'British Indian Ocean Territory',
    'iq' : 'Iraq',
    'ir' : 'Iran',
    'is' : 'Iceland',
    'it' : 'Italy',
    'je' : 'Jersey',
    'jm' : 'Jamaica',
    'jo' : 'Jordan',
    'jp' : 'Japan',
    'ke' : 'Kenya',
    'kg' : 'Kyrgyzstan',
    'kh' : 'Cambodia',
    'ki' : 'Kiribati',
    'km' : 'Comoros',
    'kn' : 'Saint Kitts and Nevis',
    'kp' : 'North Korea',
    'kr' : 'Republic of Korea',
    'kw' : 'Kuwait',
    'ky' : 'Cayman Islands',
    'kz' : 'Kazakhstan',
    'la' : 'Laos',
    'lb' : 'Lebanon',
    'lc' : 'Saint Lucia',
    'li' : 'Liechtenstein',
    'lk' : 'Sri Lanka',
    'lr' : 'Liberia',
    'ls' : 'Lesotho',
    'lt' : 'Lithuania',
    'lu' : 'Luxembourg',
    'lv' : 'Latvia',
    'ly' : 'Libya',
    'ma' : 'Morocco',
    'mc' : 'Monaco',
    'md' : 'Republic of Moldova',
    'me' : 'Montenegro',
    'mf' : 'Saint Martin',
    'mg' : 'Madagascar',
    'mh' : 'Marshall Islands',
    'mk' : 'Macedonia',
    'ml' : 'Mali',
    'mm' : 'Burma',
    'mn' : 'Mongolia',
    'mo' : 'Macau',
    'mp' : 'Northern Mariana Islands',
    'mq' : 'Martinique',
    'mr' : 'Mauritania',
    'ms' : 'Montserrat',
    'mt' : 'Malta',
    'mu' : 'Mauritius',
    'mv' : 'Maldives',
    'mw' : 'Malawi',
    'mx' : 'Mexico',
    'my' : 'Malaysia',
    'mz' : 'Mozambique',
    'na' : 'Namibia',
    'nc' : 'New Caledonia',
    'ne' : 'Niger',
    'nf' : 'Norfolk Island',
    'ng' : 'Nigeria',
    'ni' : 'Nicaragua',
    'nl' : 'Netherlands',
    'no' : 'Norway',
    'np' : 'Nepal',
    'nr' : 'Nauru',
    'nu' : 'Niue',
    'nz' : 'New Zealand',
    'om' : 'Oman',
    'pa' : 'Panama',
    'pe' : 'Peru',
    'pf' : 'French Polynesia',
    'pg' : 'Papua New Guinea',
    'ph' : 'Philippines',
    'pk' : 'Pakistan',
    'pl' : 'Poland',
    'pm' : 'Saint Pierre and Miquelon',
    'pn' : 'Pitcairn Islands',
    'pr' : 'Puerto Rico',
    'ps' : 'Palestinian Territory',
    'pt' : 'Portugal',
    'pw' : 'Palau',
    'py' : 'Paraguay',
    'qa' : 'Qatar',
    're' : 'Reunion',
    'ro' : 'Romania',
    'rs' : 'Serbia',
    'ru' : 'Russia',
    'rw' : 'Rwanda',
    'sa' : 'Saudi Arabia',
    'sb' : 'Solomon Islands',
    'sc' : 'Seychelles',
    'sd' : 'Sudan',
    'se' : 'Sweden',
    'sg' : 'Singapore',
    'sh' : 'Saint Helena',
    'si' : 'Slovenia',
    'sj' : 'Svalbard and Jan Mayen',
    'sk' : 'Slovakia',
    'sl' : 'Sierra Leone',
    'sm' : 'San Marino',
    'sn' : 'Senegal',
    'so' : 'Somalia',
    'sr' : 'Suriname',
    'st' : 'São Tomé and Príncipe',
    'sv' : 'El Salvador',
    'sy' : 'Syrian Arab Republic',
    'sz' : 'Swaziland',
    'tc' : 'Turks and Caicos Islands',
    'td' : 'Chad',
    'tf' : 'French Southern Territories',
    'tg' : 'Togo',
    'th' : 'Thailand',
    'tj' : 'Tajikistan',
    'tk' : 'Tokelau',
    'tl' : 'East Timor',
    'tm' : 'Turkmenistan',
    'tn' : 'Tunisia',
    'to' : 'Tonga',
    'tr' : 'Turkey',
    'tt' : 'Trinidad and Tobago',
    'tv' : 'Tuvalu',
    'tw' : 'Taiwan',
    'tz' : 'United Republic of Tanzania',
    'ua' : 'Ukraine',
    'ug' : 'Uganda',
    'um' : 'United States Minor Outlying Islands',
    'us' : 'United States',
    'uy' : 'Uruguay',
    'uz' : 'Uzbekistan',
    'va' : 'Vatican City',
    'vc' : 'Saint Vincent and the Grenadines',
    've' : 'Venezuela',
    'vg' : 'British Virgin Islands',
    'vi' : 'United States Virgin Islands',
    'vn' : 'Vietnam',
    'vu' : 'Vanuatu',
    'wf' : 'Wallis and Futuna',
    'ws' : 'Samoa',
    'ye' : 'Yemen',
    'yt' : 'Mayotte',
    'za' : 'South Africa',
    'zm' : 'Zambia',
    'zw' : 'Zimbabwe'
};</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.tableFields = {
    COUNTRY: 0,
    AS_NUMBER: 1,
    CONSENSUS_WEIGHT_FRACTION: 2,
    ADVERTISED_BANDWIDTH_FRACTION: 4,
    GUARD_PROBABILITY: 8,
    MIDDLE_PROBABILITY: 16,
    EXIT_PROBABILITY: 32,
    CONTACT: 64,
    FAMILY: 128,
    TOR: 256,
    OS: 512
};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/global-data.js">src/lib/global-data.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">18 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var countries = require('./static').countries,
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var countriesArray = [];</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var flags = {
        'Fast': 'fa-bolt',
        'Running': 'fa-code-fork',
        'BadExit': 'fa-warning',
        'Authority': 'fa-user-md',
        'Guard': 'fa-shield',
        'HSDir': 'fa-book',
        'Named': 'fa-info',
        'Stable': 'fa-anchor',
        'V2Dir': 'fa-folder',
        'Valid': 'fa-check',
        'Unnamed': 'fa-question',
        'Exit': 'fa-sign-out'
    },
    flagsArray = [];</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var icons = {
    // map to convert given string to a character
    'Fast': 'fa-bolt',
    'Running': 'fa-code-fork',
    'BadExit': 'fa-warning',
    'Authority': 'fa-user-md',
    'Guard': 'fa-shield',
    'HSDir': 'fa-book',
    'Named': 'fa-info',
    'Stable': 'fa-anchor',
    'V2Dir': 'fa-folder',
    'Valid': 'fa-check',
    'Unnamed': 'fa-question',
    'Exit': 'fa-sign-out'
};</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// fill countries array</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">_.forIn(countries, function (value, key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">247</td><td class="statements">100%</td><td class="source"><span class="statement ">    countriesArray.push({
        key: key,
        value: value
    });</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>});</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// fill flags array</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">_.forIn(flags, function (value, key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">12</td><td class="statements">100%</td><td class="source"><span class="statement ">    flagsArray.push({
        key: key,
        value: value
    });</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>});</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = {
    version: '',
    userAgent: '',
    title: [],
    buildTitle: function (title, version) {
        // join title segments</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        return (title.length ? title.join(' | ') + ' | Globe' : 'Globe') + ' ' + version;</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/rsplit.js">src/lib/util/rsplit.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">4 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/*eslint valid-jsdoc:0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @see https://stackoverflow.com/questions/5202085/javascript-equivalent-of-pythons-rsplit/5202185#5202185</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param str</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param sep</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param maxsplit</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {Array}</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (str, sep, maxsplit) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">    var split = str.split(sep || /s+/);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">    return maxsplit ? [ split.slice(0, -maxsplit).join(sep) ].concat(split.slice(-maxsplit)) : split;</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/connection.js">src/lib/db/connection.js</h2><div class="stats medium"><div class="percentage">74% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">73% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">59% block coverage</div><div class="sloc">163 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/* eslint no-console:0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var logger = require('../../../logger'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    MongoClient = require('mongodb').MongoClient,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    RSVP = require('rsvp'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    globalData = require('../global-data'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    getJSON = require('../onionoo/util/get-JSON'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    parsePlatform = require('../util/parse-platform'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    conf = require('../../../config'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    assert = require('assert'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    _ = require('lodash-node'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    retry = require('qretry');</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var locked = false,
    database = null,
    collections = {},</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    currentUpdateStarted = -1,</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    updateDurations = [];</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function remainingUpdateDuration() {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    if (updateDurations.length === 0) {</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // return 0 if no duration was stored (initial update)</span></td><td class="action"></td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        return 0;</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    var allDurations = _.reduce(updateDurations, function (sum, duration) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return sum + duration;</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }),</span></td><td class="action"></td></tr><tr class="miss"><td class="line">26</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        avgDuration = allDurations / updateDurations.length;</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="miss"><td class="line">28</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    return avgDuration - (Date.now() - currentUpdateStarted);</span></td><td class="action"></td></tr><tr><td class="line">29</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that indicates if the database is locked for access</span></td><td class="action"></td></tr><tr><td class="line">33</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {boolean} True if the database is locked</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function isLocked() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">19</td><td class="statements">100%</td><td class="source"><span class="statement ">    return locked;</span></td><td class="action"></td></tr><tr><td class="line">37</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">38</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that allows to &quot;lock&quot; the database</span></td><td class="action"></td></tr><tr><td class="line">40</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {void}</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">42</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function lock() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">43</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    locked = true;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    logger.info('db locked');</span></td><td class="action"></td></tr><tr><td class="line">45</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">47</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that allows to &quot;unlock&quot; the database</span></td><td class="action"></td></tr><tr><td class="line">48</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {void}</span></td><td class="action"></td></tr><tr><td class="line">49</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">50</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function unlock() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">51</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    locked = false;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">52</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    logger.info('db unlocked');</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">54</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">55</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">56</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that removes all documents in all collections</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {*} Promise that resolves after all collections are &quot;cleared&quot;</span></td><td class="action"></td></tr><tr><td class="line">58</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">59</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function clearCollections() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">60</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return RSVP.all([</span></td><td class="action"></td></tr><tr class="hit "><td class="line">61</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        RSVP.denodeify(collections.relays.remove.bind(collections.relays))(),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">62</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        RSVP.denodeify(collections.bridges.remove.bind(collections.bridges))()</span></td><td class="action"></td></tr><tr><td class="line">63</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    ]);</span></td><td class="action"></td></tr><tr><td class="line">64</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">65</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">66</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function isReadyToClearAndInsert() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">67</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve, reject) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">68</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        database.collection('$cmd.sys.inprog').findOne(function (err, data) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">69</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                throw err;</span></td><td class="action"></td></tr><tr><td class="line">71</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">72</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (data.inprog.length) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                reject();</span></td><td class="action"></td></tr><tr><td class="line">74</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">75</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                resolve();</span></td><td class="action"></td></tr><tr><td class="line">76</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">77</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">78</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">79</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">80</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">81</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that clears all collections, loads the onionoo dump and inserts the result</span></td><td class="action"></td></tr><tr><td class="line">82</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {exports.Promise} Promise that resolves after filling the database.</span></td><td class="action"></td></tr><tr><td class="line">83</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">84</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function reloadData() {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">85</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve, reject) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">86</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        assert(!!database, 'To reload data the database has to exist');</span></td><td class="action"></td></tr><tr><td class="line">87</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">88</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        var downloadStarted = Date.now();</span></td><td class="action"></td></tr><tr class="hit "><td class="line">89</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        logger.info('Downloading details dump from onionoo. ' +
            'This could take a while, depending on your internet connection.');</span></td><td class="action"></td></tr><tr><td class="line">90</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">91</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // load onionoo data</span></td><td class="action"></td></tr><tr class="hit "><td class="line">92</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        getJSON('details').then(function (result) {
            // store time before dataset update</span></td><td class="action"></td></tr><tr class="hit "><td class="line">93</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            currentUpdateStarted = Date.now();</span></td><td class="action"></td></tr><tr><td class="line">94</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">95</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // add current download duration</span></td><td class="action"></td></tr><tr class="hit "><td class="line">96</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            logger.info('Download finished. Took %s ms', Date.now() - downloadStarted);</span></td><td class="action"></td></tr><tr><td class="line">97</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">98</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // set lock flag before sync</span></td><td class="action"></td></tr><tr class="hit "><td class="line">99</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            lock();</span></td><td class="action"></td></tr><tr><td class="line">100</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">101</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            retry(isReadyToClearAndInsert).then(function () {

                // check if any
                // remove old collection if exists</span></td><td class="action"></td></tr><tr class="hit "><td class="line">102</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                clearCollections().then(function () {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">103</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    var //result = dump,
                        insertPromises = [],
                        osMap = {},
                        versions = {};</span></td><td class="action"></td></tr><tr><td class="line">104</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">105</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    // prepare data for easier later queries</span></td><td class="action"></td></tr><tr class="hit "><td class="line">106</td><td class="hits">2424</td><td class="statements">100%</td><td class="source"><span class="statement ">                    for (var relayIndex = 0; relayIndex &lt; result.relays.length; relayIndex++) {</span></td><td class="action"></td></tr><tr><td class="line">107</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        /* eslint camelcase:0 */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">108</td><td class="hits">2420</td><td class="statements">100%</td><td class="source"><span class="statement ">                        var relay = result.relays[relayIndex],
                            target = relay.exit_policy_summary.accept ? 'accept' : 'reject';</span></td><td class="action"></td></tr><tr><td class="line">109</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">110</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // extract os</span></td><td class="action"></td></tr><tr><td class="line">111</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        if (relay.platform) {</span></td><td class="action"></td></tr><tr><td class="line">112</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            try {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">113</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                var parsedPlatform = parsePlatform(relay.platform);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">114</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.tor = parsedPlatform.tor;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">115</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.git = parsedPlatform.git;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">116</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.meta = parsedPlatform.meta;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">117</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.arch = parsedPlatform.arch;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">118</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.os = parsedPlatform.os;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">119</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.version = parsedPlatform.version;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">120</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.client = parsedPlatform.client;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">121</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.osString = parsedPlatform.osString;</span></td><td class="action"></td></tr><tr><td class="line">122</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">123</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                // add array with null for group by family</span></td><td class="action"></td></tr><tr class="hit "><td class="line">124</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.family = relay.family ? relay.family : [null];</span></td><td class="action"></td></tr><tr><td class="line">125</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                // add null if no contact for group by contact</span></td><td class="action"></td></tr><tr class="hit "><td class="line">126</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.contact = relay.contact ? relay.contact : null;</span></td><td class="action"></td></tr><tr><td class="line">127</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                // add null if no contact for group by contact</span></td><td class="action"></td></tr><tr class="hit "><td class="line">128</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.country = relay.country ? relay.country : null;</span></td><td class="action"></td></tr><tr><td class="line">129</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                // add null if no contact for group by contact</span></td><td class="action"></td></tr><tr class="hit "><td class="line">130</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.as_number = relay.as_number ? relay.as_number : null;</span></td><td class="action"></td></tr><tr><td class="line">131</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">132</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                osMap[relay.os] = osMap[relay.os] &gt;= 0 ? osMap[relay.os] + 1 : 1;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">133</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">                                versions[relay.tor] = versions[relay.tor] &gt;= 0 ? versions[relay.tor] + 1 : 1;</span></td><td class="action"></td></tr><tr><td class="line">134</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            } catch (e) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">135</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                logger.info(relay.nickname, e.message);</span></td><td class="action"></td></tr><tr><td class="line">136</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">137</td><td class="hits">2420</td><td class="statements">100%</td><td class="source"><span class="statement ">                        relay.exit_policy_summary['_' + target] = [];</span></td><td class="action"></td></tr><tr class="hit "><td class="line">138</td><td class="hits">2420</td><td class="statements">100%</td><td class="source"><span class="statement ">                        relay.exit_policy_summary['_' + target + '_range'] = [];</span></td><td class="action"></td></tr><tr><td class="line">139</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">140</td><td class="hits">5052</td><td class="statements">100%</td><td class="source"><span class="statement ">                        for (var portRangeIndex = 0; portRangeIndex &lt; relay.exit_policy_summary[target].length; portRangeIndex++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">141</td><td class="hits">2632</td><td class="statements">100%</td><td class="source"><span class="statement ">                            var portRange = relay.exit_policy_summary[target][portRangeIndex],
                                range = portRange.split('-');</span></td><td class="action"></td></tr><tr><td class="line">142</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">143</td><td class="hits">2632</td><td class="statements">100%</td><td class="source"><span class="statement ">                            if (range.length === 2) {</span></td><td class="action"></td></tr><tr><td class="line">144</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                // is port range</span></td><td class="action"></td></tr><tr class="hit "><td class="line">145</td><td class="hits">60</td><td class="statements">100%</td><td class="source"><span class="statement ">                                var start = parseInt(range[0], 10),
                                    end = parseInt(range[1], 10);</span></td><td class="action"></td></tr><tr><td class="line">146</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">147</td><td class="hits">60</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.exit_policy_summary['_' + target + '_range'].push({
                                    start: start,
                                    end: end
                                });</span></td><td class="action"></td></tr><tr><td class="line">148</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">149</td><td class="hits">2572</td><td class="statements">100%</td><td class="source"><span class="statement ">                                relay.exit_policy_summary['_' + target].push(parseInt(portRange, 10));</span></td><td class="action"></td></tr><tr><td class="line">150</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            }</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">151</td><td class="hits">4</td><td class="statements">67%</td><td class="source"><span class="statement ">                    for (var bridgeIndex = 0; bridgeIndex &lt; result.bridges.length;</span><span class="statement notok"><span class="offscreen"> not covered </span>bridgeIndex++</span><span class="statement "> {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        var bridge = result.bridges[bridgeIndex];</span></td><td class="action"></td></tr><tr><td class="line">153</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        if (bridge.platform) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">154</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                var parsedBridgePlatform = parsePlatform(bridge.platform);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">155</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.tor = parsedBridgePlatform.tor;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">156</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.git = parsedBridgePlatform.git;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.meta = parsedBridgePlatform.meta;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.arch = parsedBridgePlatform.arch;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.os = parsedBridgePlatform.os;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.version = parsedBridgePlatform.version;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.client = parsedBridgePlatform.client;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">162</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                bridge.osString = parsedBridgePlatform.osString;</span></td><td class="action"></td></tr><tr><td class="line">163</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                osMap[relay.os] = osMap[relay.os] &gt;= 0 ? osMap[relay.os] + 1 : 1;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">165</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                versions[relay.tor] = versions[relay.tor] &gt;= 0 ? versions[relay.tor] + 1 : 1;</span></td><td class="action"></td></tr><tr><td class="line">166</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            } catch (e) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">167</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                                logger.warn(e.message);</span></td><td class="action"></td></tr><tr><td class="line">168</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">169</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    var valNumMapFn = function (result, value, key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">170</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">                            result.push({val: key, num: value});</span></td><td class="action"></td></tr><tr><td class="line">171</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        },</span></td><td class="action"></td></tr><tr class="hit "><td class="line">172</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">                            return obj.val;</span></td><td class="action"></td></tr><tr><td class="line">173</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        }, sortFn = function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">174</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">                            return b.num - a.num;</span></td><td class="action"></td></tr><tr><td class="line">175</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        };</span></td><td class="action"></td></tr><tr><td class="line">176</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">177</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    globalData.search.os = _.transform(osMap, valNumMapFn, []).sort(sortFn).map(mapFn);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">178</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    globalData.search.tor = _.transform(versions, valNumMapFn, []).sort(sortFn).map(mapFn);</span></td><td class="action"></td></tr><tr><td class="line">179</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">180</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    logger.info('overwrote available os:', JSON.stringify(globalData.search.os));</span></td><td class="action"></td></tr><tr class="hit "><td class="line">181</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    logger.info('overwrote available tor versions:', JSON.stringify(globalData.search.tor));</span></td><td class="action"></td></tr><tr><td class="line">182</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">183</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    if (result.relays.length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">184</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        insertPromises.push(RSVP.denodeify(collections.relays.insert.bind(collections.relays))(result.relays, {}));</span></td><td class="action"></td></tr><tr><td class="line">185</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">186</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        insertPromises.push(RSVP.denodeify(collections.bridges.insert.bind(collections.bridges))(result.bridges, {}));</span></td><td class="action"></td></tr><tr><td class="line">187</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">188</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    RSVP.all(insertPromises).then(function () {
                        // unlock database after sync</span></td><td class="action"></td></tr><tr class="hit "><td class="line">189</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        unlock();</span></td><td class="action"></td></tr><tr><td class="line">190</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">191</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        updateDurations.push(Date.now() - currentUpdateStarted);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">192</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        if (updateDurations.length &gt; 10) {</span></td><td class="action"></td></tr><tr><td class="line">193</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            // remove oldest value from array if length &gt; 10</span></td><td class="action"></td></tr><tr class="miss"><td class="line">194</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            updateDurations.splice(0, 1);</span></td><td class="action"></td></tr><tr><td class="line">195</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">196</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        currentUpdateStarted = -1;</span></td><td class="action"></td></tr><tr><td class="line">197</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // log update durations</span></td><td class="action"></td></tr><tr class="hit "><td class="line">198</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        logger.info('Download finished. Took %s ms', updateDurations[updateDurations.length - 1]);</span></td><td class="action"></td></tr><tr><td class="line">199</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">200</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // resolve with database and created collection</span></td><td class="action"></td></tr><tr class="hit "><td class="line">201</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                        resolve();</span></td><td class="action"></td></tr><tr><td class="line">202</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">203</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }, function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">204</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        logger.info(err.message);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">205</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        reject(err);</span></td><td class="action"></td></tr><tr><td class="line">206</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    });</span></td><td class="action"></td></tr><tr><td class="line">207</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }, function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">208</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    logger.warn(err.message);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">209</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    reject(err);</span></td><td class="action"></td></tr><tr><td class="line">210</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                });</span></td><td class="action"></td></tr><tr><td class="line">211</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }, function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">212</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                logger.warn(err.message);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">213</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                reject(err);</span></td><td class="action"></td></tr><tr><td class="line">214</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            });</span></td><td class="action"></td></tr><tr><td class="line">215</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">216</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }, function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">217</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            logger.error(err.message);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">218</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            reject(err);</span></td><td class="action"></td></tr><tr><td class="line">219</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr><td class="line">220</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">221</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">222</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">223</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">224</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">225</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that connects to the database and populates it.</span></td><td class="action"></td></tr><tr><td class="line">226</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {exports.Promise} Promise that resolves after connecting to the database and creating the required structures.</span></td><td class="action"></td></tr><tr><td class="line">227</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} opts Configuration object</span></td><td class="action"></td></tr><tr><td class="line">228</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">229</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function init(opts) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">230</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    var skipReloadData = opts.skipReload,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">231</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        waitForReload = !!opts.waitForReload,</span></td><td class="action"></td></tr><tr><td class="line">232</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        dbUrl = opts.dbUrl;</span></td><td class="action"></td></tr><tr><td class="line">233</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">234</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    assert(typeof dbUrl === 'string', 'Expected a database url.');</span></td><td class="action"></td></tr><tr><td class="line">235</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">236</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve, reject) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">237</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        logger.info('connecting to mongodb');</span></td><td class="action"></td></tr><tr><td class="line">238</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">239</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // connect to db</span></td><td class="action"></td></tr><tr class="hit "><td class="line">240</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        MongoClient.connect(dbUrl, function (err, db) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">241</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">242</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                logger.error(err);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">243</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                reject(err);</span></td><td class="action"></td></tr><tr><td class="line">244</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">245</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                database = db;</span></td><td class="action"></td></tr><tr><td class="line">246</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">247</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                // create collections for relays and bridges</span></td><td class="action"></td></tr><tr class="hit "><td class="line">248</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                RSVP.hash({</span></td><td class="action"></td></tr><tr class="hit "><td class="line">249</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    relays: RSVP.denodeify(database.createCollection.bind(database))('relays'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">250</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    bridges: RSVP.denodeify(database.createCollection.bind(database))('bridges')</span></td><td class="action"></td></tr><tr><td class="line">251</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }).then(function (createdCollections) {</span></td><td class="action"></td></tr><tr><td class="line">252</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">253</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    collections = createdCollections;</span></td><td class="action"></td></tr><tr><td class="line">254</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">255</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    var resolveData = {</span></td><td class="action"></td></tr><tr><td class="line">256</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        database: database,</span></td><td class="action"></td></tr><tr><td class="line">257</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        isLocked: isLocked,</span></td><td class="action"></td></tr><tr><td class="line">258</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        collections: createdCollections</span></td><td class="action"></td></tr><tr><td class="line">259</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">260</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    if (!skipReloadData) {</span></td><td class="action"></td></tr><tr><td class="line">261</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // Lock the database and start the initial onionoo data loading.</span></td><td class="action"></td></tr><tr><td class="line">262</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // We don't wait for it to complete and resolve immediately.</span></td><td class="action"></td></tr><tr class="hit "><td class="line">263</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                        lock();</span></td><td class="action"></td></tr><tr class="hit "><td class="line">264</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                        if (waitForReload) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">265</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                            reloadData().then(function () {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">266</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                                resolve(resolveData);</span></td><td class="action"></td></tr><tr><td class="line">267</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            });</span></td><td class="action"></td></tr><tr><td class="line">268</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                            reloadData();</span></td><td class="action"></td></tr><tr><td class="line">270</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">271</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    if (!waitForReload) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        resolve(resolveData);</span></td><td class="action"></td></tr><tr><td class="line">273</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }</span></td><td class="action"></td></tr><tr><td class="line">274</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">275</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">276</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">277</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">278</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">279</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that creates an interval that reloads the database structure + onionoo dump</span></td><td class="action"></td></tr><tr><td class="line">280</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {void}</span></td><td class="action"></td></tr><tr><td class="line">281</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">282</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function initSyncTask() {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">283</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    setTimeout(function syncTimeout() {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">284</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        reloadData().then(function () {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">285</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            initSyncTask();</span></td><td class="action"></td></tr><tr><td class="line">286</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr><td class="line">287</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }, conf.DB.SYNC_INTERVAL);</span></td><td class="action"></td></tr><tr><td class="line">288</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">289</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">290</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = {
    remainingUpdateDuration: remainingUpdateDuration,
    init: init,
    initSyncTask: initSyncTask,
    lock: lock,
    unlock: unlock,
    isLocked: isLocked,
    reloadData: reloadData
};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/onionoo/util/get-JSON.js">src/lib/onionoo/util/get-JSON.js</h2><div class="stats high"><div class="percentage">83% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">79% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">62% block coverage</div><div class="sloc">18 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var config = require('../../../../config').ONIONOO,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    userAgent = require('../../global-data').userAgent,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    request = require('request'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    RSVP = require('rsvp');</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(path) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function(resolve, reject){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        request.get(config.BASE_URL + path, {
            headers: {
                'User-Agent': userAgent
            },
            timeout: config.REQUEST_TIMEOUT
        }, function(err, resp, body){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            var parsedBody;</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">12</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                reject(err);</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                if (resp.statusCode === 500) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    reject('Request returned: 500 Internal Server Error');</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                try{</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                    parsedBody = JSON.parse(body);</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                } catch (e) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">20</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    reject(e);</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                resolve(parsedBody);</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/parse-platform.js">src/lib/util/parse-platform.js</h2><div class="stats high"><div class="percentage">96% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">97% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">90% block coverage</div><div class="sloc">52 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var rsplit = require('../util/rsplit'),
    assert = require('assert');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var WORDS = {
    ON: ' on ',
    X86_64: 'x86_64',
    I686: 'i686',
    TOR: 'Tor'
};</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Parses an given string and extracts os related values.</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} osString</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {{os: String|undefined, version: String|undefined, meta: String|undefined, arch: String|undefined}} Object containing common os related values.</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @example</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * parseOs('Windows 7 Service Pack 1 [workstation]')</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * // {os: 'Windows', version: '7', meta: '[workstation]', arch: undefined}</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * parseOs('Linux x86_64')</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * // {os: 'Linux', arch: 'x86_64', version: undefined, meta: undefined}</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>function parseOs(osString) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    var arch,
        meta,
        os,
        version,
        name;</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // extract arch</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (osString.indexOf(WORDS.X86_64) &gt;= 0) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">        arch = WORDS.X86_64;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">23</td><td class="statements">100%</td><td class="source"><span class="statement ">    } else if (osString.indexOf(WORDS.I686) &gt;= 0) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        arch = WORDS.I686;</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // extract meta (Windows [workstation])</span></td><td class="action"></td></tr><tr class="hit "><td class="line">27</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (osString.match(/[\[\]]/)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        var words = osString.split(' '),
        // for [server] {enterprise} {terminal services, single user} {terminal services}'
            startIndex = -1;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        words.every(function (word, index) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">48</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (word.indexOf('[') &gt;= 0) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                startIndex = index;</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">33</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // stop loop if startIndex has changed (return false), otherwise continue (return true)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">34</td><td class="hits">48</td><td class="statements">100%</td><td class="source"><span class="statement ">            return startIndex === -1;</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (startIndex &gt;= 0) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            meta = words.splice(startIndex).join(' ');</span></td><td class="action"></td></tr><tr><td class="line">38</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">39</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        osString = words.join(' ');</span></td><td class="action"></td></tr><tr><td class="line">40</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">42</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // extract full os string</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // (Windows 7 Service Pack 1)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (meta &amp;&amp; meta.length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        name = osString;</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">47</td><td class="hits">21</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (arch &amp;&amp; arch.length) {</span></td><td class="action"></td></tr><tr><td class="line">48</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // Linux i686</span></td><td class="action"></td></tr><tr class="hit "><td class="line">49</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">            name = osString.substring(0, osString.indexOf(arch)).trim();</span></td><td class="action"></td></tr><tr><td class="line">50</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr><td class="line">51</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // Linux</span></td><td class="action"></td></tr><tr class="hit "><td class="line">52</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">            name = osString;</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr><td class="line">54</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr><td class="line">55</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">56</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // extract os name (Windows, Linux, ...)</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    if (name.length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">58</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        os = name.split(' ')[0];</span></td><td class="action"></td></tr><tr><td class="line">59</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr><td class="line">60</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">61</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // extract os version (7 Service Pack 1)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">62</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (os &amp;&amp; os.length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">63</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (!arch &amp;&amp; osString.length !== os.length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">64</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">            version = osString.substring(os.length).trim();</span></td><td class="action"></td></tr><tr><td class="line">65</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr><td class="line">66</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr><td class="line">67</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">68</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    return {
        os: os,
        version: version,
        meta: meta,
        arch: arch
    };</span></td><td class="action"></td></tr><tr><td class="line">69</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>}</span></td><td class="action"></td></tr><tr><td class="line">70</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">71</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">72</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Parses a onionoo platform string.</span></td><td class="action"></td></tr><tr><td class="line">73</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} platformString Platform string to parse.</span></td><td class="action"></td></tr><tr><td class="line">74</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {{client: (string|*), tor: *, git: *, meta: (String|undefined|*), arch: (String|undefined|*), os: (String|undefined|*), version: (String|undefined|*), osString: String}} Parsed platform</span></td><td class="action"></td></tr><tr><td class="line">75</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">76</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (platformString) {
    //assert.ok(platformString.indexOf('Tor') === 0, 'Not a Tor platform string.');

    //platformString = platformString.toLowerCase();</span></td><td class="action"></td></tr><tr class="hit "><td class="line">77</td><td class="hits">33</td><td class="statements">100%</td><td class="source"><span class="statement ">    var onPos = platformString.indexOf(WORDS.ON),
    // torversion = 'Tor ' (4) ... 'on'</span></td><td class="action"></td></tr><tr class="hit "><td class="line">78</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        torClient = platformString.substring(0, platformString.indexOf(' ')),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">79</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        torVersion = platformString.substring(torClient.length + 1, onPos),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">80</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        on = platformString.substring(onPos + WORDS.ON.length, platformString.length),</span></td><td class="action"></td></tr><tr><td class="line">81</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        tor,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">82</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        os = parseOs(on),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">83</td><td class="hits">33</td><td class="statements">100%</td><td class="source"><span class="statement ">        torVerGitSep = torVersion.indexOf(' ');</span></td><td class="action"></td></tr><tr><td class="line">84</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">85</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (torVerGitSep &gt;= 0) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">86</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">        tor = torVersion.substring(0, torVerGitSep);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">87</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">        git = torVersion.substring(torVerGitSep + 1, torVersion.length);</span></td><td class="action"></td></tr><tr><td class="line">88</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // remove brackets, minus from git version</span></td><td class="action"></td></tr><tr class="hit "><td class="line">89</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">            git = git.replace(new RegExp('[-\\(\\)]', 'g'), '').replace('git', '');</span></td><td class="action"></td></tr><tr><td class="line">90</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">91</td><td class="hits">13</td><td class="statements">100%</td><td class="source"><span class="statement ">        tor = torVersion;</span></td><td class="action"></td></tr><tr><td class="line">92</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">93</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!tor.length) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">94</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        tor = undefined;</span></td><td class="action"></td></tr><tr><td class="line">95</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">96</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!torClient) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">97</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        torClient = undefined;</span></td><td class="action"></td></tr><tr><td class="line">98</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">99</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">    return {
        client: torClient,
        tor: tor,
        git: git,
        meta: os.meta,
        arch: os.arch,
        os: os.os,
        version: os.version,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">100</td><td class="hits">30</td><td class="statements">100%</td><td class="source"><span class="statement ">        osString: [os.os, os.version, os.arch].join(' ').replace(/ +/g, ' ').trim()</span></td><td class="action"></td></tr><tr><td class="line">101</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">102</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/filter.js">src/lib/db/onionoo-mongo/filter.js</h2><div class="stats high"><div class="percentage">85% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">85% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">60% block coverage</div><div class="sloc">64 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/*eslint camelcase:0, no-console:0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var RSVP = require('rsvp'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    logger = require('../../../../logger'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    connection = require('../connection'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    _ = require('lodash-node'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    getSortType = require('../../util/get-sort-type'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    processFilterResults = require('./process-filter-results'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    createMongoFilter = require('./create-mongo-filter'),</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// filters</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    speeds = require('./speeds'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    exitSpeedFilter = require('../filters/exit-speed'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    sameNetworkFilter = require('../filters/same-network'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    createSortFn = require('../../util/create-sort-fn');</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var defaultOpts = {
    sortBy: 'consensus_weight_fraction',
    sortAsc: false,
    displayAmount: 10,
    filter: {
        os: null,
        exitSpeed: null,
        running: null,
        guards: null,
        exit: null,
        family: null,
        as: null,
        country: null,
        speed: null
    }
};</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Calls mongodb filter</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @throws throws an error if the database is locked</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} collections Mongodb collection</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} methodOpts Options for the filter method</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {rsvp$umd$$RSVP.Promise} Promise that resolves with filtered result</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (collections, methodOpts) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">    var opts = _.merge({}, defaultOpts, methodOpts),
        filterOpts = opts.filter,
        sortObj = {},
        relays = collections.relays,
        bridges = collections.bridges,
        hasExitSpeedFilter,
        hasSameNetworkFilter,
        dbOpts,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">        sortFnType = getSortType(opts.sortBy),</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">27</td><td class="hits">18</td><td class="statements">67%</td><td class="source"><span class="statement ">        sortFn = (createSortFn[sortFnType] ? createSortFn[sortFnType] :</span><span class="statement notok"><span class="offscreen"> not covered </span>createSortFn.numeric</span><span class="statement ">(opts.sortBy, opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">29</td><td class="hits">18</td><td class="statements">67%</td><td class="source"><span class="statement ">    sortObj[opts.sortBy] = opts.sortAsc ?</span><span class="statement notok"><span class="offscreen"> not covered </span>1</span><span class="statement ">: -1;</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    if (filterOpts.exitSpeed) {</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // get exitSpeed object for given string</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterOpts.exitSpeed = speeds[filterOpts.exitSpeed];</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">35</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">    dbOpts = createMongoFilter(filterOpts);</span></td><td class="action"></td></tr><tr><td class="line">36</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">    hasExitSpeedFilter = filterOpts.exitSpeed !== null;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">    hasSameNetworkFilter = hasExitSpeedFilter &amp;&amp; filterOpts.exitSpeed.MAX_PER_NETWORK;</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve, reject) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">41</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">        var relayFilterFn = RSVP.denodeify(</span></td><td class="action"></td></tr><tr><td class="line">42</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                relays</span></td><td class="action"></td></tr><tr class="hit "><td class="line">43</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .find(dbOpts)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .sort(sortObj)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .toArray.bind(relays)),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">46</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">            bridgeFilterFn = RSVP.denodeify(</span></td><td class="action"></td></tr><tr><td class="line">47</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                bridges</span></td><td class="action"></td></tr><tr class="hit "><td class="line">48</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .find(dbOpts)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">49</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .sort(sortObj)</span></td><td class="action"></td></tr><tr class="hit "><td class="line">50</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">                    .toArray.bind(bridges));</span></td><td class="action"></td></tr><tr><td class="line">51</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">52</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (typeof filterOpts.type === 'string') {</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // has filter type specified</span></td><td class="action"></td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            var returnEmptyArray = function () {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                return [];</span></td><td class="action"></td></tr><tr><td class="line">56</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            };</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            switch (filterOpts.type) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    bridgeFilterFn = returnEmptyArray;</span></td><td class="action"></td></tr><tr><td class="line">59</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    break;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    relayFilterFn = returnEmptyArray;</span></td><td class="action"></td></tr><tr><td class="line">61</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    break;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">62</td><td class="hits">18</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (connection.isLocked()) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">63</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            reject({
                dbLocked: true
            });</span></td><td class="action"></td></tr><tr><td class="line">64</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                dbLocked: true</span></td><td class="action"></td></tr><tr class="hit "><td class="line">65</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            resolve(RSVP.hash({</span></td><td class="action"></td></tr><tr class="hit "><td class="line">66</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                relays: relayFilterFn(),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">67</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                bridges: bridgeFilterFn()</span></td><td class="action"></td></tr><tr><td class="line">68</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }).then(function (results) {</span></td><td class="action"></td></tr><tr><td class="line">69</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                // manually filtering :(</span></td><td class="action"></td></tr><tr class="hit "><td class="line">70</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                var filteredRelays = results.relays;</span></td><td class="action"></td></tr><tr><td class="line">71</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">72</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                if (hasExitSpeedFilter) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">73</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    filteredRelays = exitSpeedFilter(filteredRelays, filterOpts.exitSpeed.PORTS);</span></td><td class="action"></td></tr><tr><td class="line">74</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }</span></td><td class="action"></td></tr><tr><td class="line">75</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">76</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                if (hasSameNetworkFilter) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">77</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    filteredRelays = sameNetworkFilter(filteredRelays, filterOpts.exitSpeed.MAX_PER_NETWORK);</span></td><td class="action"></td></tr><tr><td class="line">78</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }</span></td><td class="action"></td></tr><tr><td class="line">79</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">80</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                return processFilterResults({</span></td><td class="action"></td></tr><tr><td class="line">81</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    sortFn: sortFn,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">82</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                }).then(function (processedResults) {</span></td><td class="action"></td></tr><tr><td class="line">83</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    // TODO: add flags if special UI is needed</span></td><td class="action"></td></tr><tr class="hit "><td class="line">84</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                    processedResults.uiFlags = {};</span></td><td class="action"></td></tr><tr class="hit "><td class="line">85</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                    return processedResults;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">86</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                }).catch(function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    logger.error(err.message);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    reject(err);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">89</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                });</span></td><td class="action"></td></tr><tr><td class="line">90</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">91</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }, function (err) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                logger.err('filter', err);</span></td><td class="action"></td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                reject(err);</span></td><td class="action"></td></tr><tr><td class="line">94</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }));</span></td><td class="action"></td></tr><tr><td class="line">95</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr><td class="line">96</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/get-sort-type.js">src/lib/util/get-sort-type.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">11 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that returnes a sort type for a given property name.</span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} propertyName Name of the property</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {String|undefined} Found type or undefined.</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (propertyName) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">37</td><td class="statements">100%</td><td class="source"><span class="statement ">    var sortTypes = {
            numeric: ['consensus_weight_fraction', 'advertised_bandwidth_fraction', 'guard_probability',
                'middle_probability', 'exit_probability'],
            string: ['family', 'osString', 'os', 'contact', 'nickname', 'country', 'fingerprint', 'as_number'],
            version: ['tor']
        },
        foundType;</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // every breaks on return false</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">37</td><td class="statements">100%</td><td class="source"><span class="statement ">    Object.keys(sortTypes).every(function (sortType) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">52</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (sortTypes[sortType].indexOf(propertyName) &gt; -1) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">32</td><td class="statements">100%</td><td class="source"><span class="statement ">            foundType = sortType;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">32</td><td class="statements">100%</td><td class="source"><span class="statement ">            return false;</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">        return true;</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">37</td><td class="statements">100%</td><td class="source"><span class="statement ">    return foundType;</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/process-filter-results.js">src/lib/db/onionoo-mongo/process-filter-results.js</h2><div class="stats high"><div class="percentage">82% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">77% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">64% block coverage</div><div class="sloc">41 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/* eslint camelcase:0, no-underscore-dangle: 0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var RSVP = require('rsvp'),
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (filterResults) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isArray(filterResults.relays)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterResults.relays = [];</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isArray(filterResults.bridges)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterResults.bridges = [];</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isFunction(filterResults.sortFn)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterResults.sortFn = function (a, b) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return b.consensus_weight_fraction - a.consensus_weight_fraction;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        };</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        var relay,
            bridge,
            displayed = {
                relays: [],
                bridges: []
            },
            displayLimit = filterResults.displayLimit,
            notDisplayed = {
                relays: {
                    number: 0,
                    consensus_weight_fraction: 0,
                    advertised_bandwidth_fraction: 0,
                    guard_probability: 0,
                    middle_probability: 0,
                    exit_probability: 0
                },
                bridges: {
                    number: 0,
                    advertised_bandwidth: 0
                }
            };</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (displayLimit &lt;= 0) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            displayLimit = Math.max(filterResults.relays.length, filterResults.bridges.length);</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">6010</td><td class="statements">100%</td><td class="source"><span class="statement ">            return val !== null &amp;&amp; val !== undefined &amp;&amp; val !== -1;</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterResults.relays = filterResults.relays.sort(filterResults.sortFn);</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // generate aggregated filterResults</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">1252</td><td class="statements">100%</td><td class="source"><span class="statement ">        for (var index = 0, max = filterResults.relays.length; index &lt; max; index++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">1242</td><td class="statements">100%</td><td class="source"><span class="statement ">            relay = filterResults.relays[index];</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // remove &quot;private&quot; fields</span></td><td class="action"></td></tr><tr class="hit "><td class="line">32</td><td class="hits">1242</td><td class="statements">100%</td><td class="source"><span class="statement ">            delete relay._id;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">1242</td><td class="statements">100%</td><td class="source"><span class="statement ">            delete relay.exit_policy_summary._accept;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">34</td><td class="hits">1242</td><td class="statements">100%</td><td class="source"><span class="statement ">            delete relay.exit_policy_summary._accept_range;</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">1242</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (index &gt;= displayLimit) {</span></td><td class="action"></td></tr><tr><td class="line">37</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                // is not displayed</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">1202</td><td class="statements">100%</td><td class="source"><span class="statement ">                notDisplayed.relays.number++;</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">39</td><td class="hits">1202</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.consensus_weight_fraction += canAdd(relay.consensus_weight_fraction) ? relay.consensus_weight_fraction :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">40</td><td class="hits">1202</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.advertised_bandwidth_fraction += canAdd(relay.advertised_bandwidth_fraction) ? relay.advertised_bandwidth_fraction :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">41</td><td class="hits">1202</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.guard_probability += canAdd(relay.guard_probability) ? relay.guard_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">42</td><td class="hits">1202</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.middle_probability += canAdd(relay.middle_probability) ? relay.middle_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">43</td><td class="hits">1202</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.exit_probability += canAdd(relay.exit_probability) ? relay.exit_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr><td class="line">44</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">40</td><td class="statements">100%</td><td class="source"><span class="statement ">                displayed.relays.push(relay);</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">47</td><td class="hits">10</td><td class="statements">67%</td><td class="source"><span class="statement ">        for (var bridgeIndex = 0; bridgeIndex &lt; filterResults.bridges.length;</span><span class="statement notok"><span class="offscreen"> not covered </span>bridgeIndex++</span><span class="statement "> {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            bridge = filterResults.bridges[bridgeIndex];</span></td><td class="action"></td></tr><tr><td class="line">49</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (bridgeIndex &gt;= displayLimit) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                notDisplayed.bridges.number++;</span></td><td class="action"></td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                notDisplayed.bridges.advertised_bandwidth += canAdd(bridge.advertised_bandwidth) ? bridge.advertised_bandwidth : 0;</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                displayed.bridges.push(bridge);</span></td><td class="action"></td></tr><tr><td class="line">55</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">56</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        resolve({
            notDisplayed: notDisplayed,
            displayed: displayed,
            numBridges: filterResults.bridges.length,
            numRelays: filterResults.relays.length
        });</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">58</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/create-mongo-filter.js">src/lib/db/onionoo-mongo/create-mongo-filter.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">98% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">100% block coverage</div><div class="sloc">45 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/* eslint camelcase:0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var speeds = require('./speeds'),
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Add a value to a target after checking if another value exists and it isn't empty</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} target Mongodb filter object</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} targetField Mongodb filter object field</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {*} checkValue Value to check</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {*} assignedValue Mongodb filter expression</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {void}</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var addToOptionIf = function (target, targetField, checkValue, assignedValue) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">342</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (checkValue !== undefined &amp;&amp; checkValue !== null) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (_.isArray(checkValue)) {</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (checkValue.length) {</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">17</td><td class="hits">2</td><td class="statements">75%</td><td class="source"><span class="statement ">                target[targetField] = _.isFunction(assignedValue) ?</span><span class="statement notok"><span class="offscreen"> not covered </span>assignedValue(checkValue)</span><span class="statement ">: assignedValue;</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            target[targetField] = _.isFunction(assignedValue) ? assignedValue(checkValue) : assignedValue;</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (filterOptions) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    var dbFilterOptions = {},</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">        hasExitSpeedFilter = filterOptions.exitSpeed !== null &amp;&amp; filterOptions.exitSpeed !== undefined,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">        notFaster = hasExitSpeedFilter &amp;&amp; filterOptions.exitSpeed.NOT_FASTER;</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//        hasSameNetworkFilter = hasExitSpeedFilter &amp;&amp; filterOptions.exitSpeed.MAX_PER_NETWORK;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">27</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasExitSpeedFilter) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (notFaster) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            dbFilterOptions.bandwidth_rate = {
                $gt: filterOptions.exitSpeed.BANDWIDTH_RATE,
                $lt: speeds.FAST_EXIT.BANDWIDTH_RATE
            };</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                $gt: filterOptions.exitSpeed.BANDWIDTH_RATE,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            dbFilterOptions.advertised_bandwidth = {
                $gt: filterOptions.exitSpeed.ADVERTISED_BANDWIDTH,
                $lt: speeds.FAST_EXIT.ADVERTISED_BANDWIDTH
            };</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            dbFilterOptions.bandwidth_rate = {
                $gt: filterOptions.exitSpeed.BANDWIDTH_RATE
            };</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // advertised_banwdith filter</span></td><td class="action"></td></tr><tr class="hit "><td class="line">35</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            dbFilterOptions.advertised_bandwidth = {
                $gt: filterOptions.exitSpeed.ADVERTISED_BANDWIDTH
            };</span></td><td class="action"></td></tr><tr><td class="line">36</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (_.isString(filterOptions.query)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        var query = filterOptions.query;</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // copy of onionoo RequestHandler.java.filterBySearchTerm</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (query[0] === '$') {</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                /* Search is for $-prefixed fingerprint. */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                dbFilterOptions.fingerprint = query.substring(1).toUpperCase();</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                dbFilterOptions.$or = [
                    /* Nickname matches. */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    {nickname: {$regex: new RegExp('.*' + query.toLowerCase() + '.*') }},</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    /* Non-$-prefixed fingerprint matches. */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">47</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    {fingerprint: {$regex: new RegExp('^' + query.toUpperCase()) }},</span></td><td class="action"></td></tr><tr class="hit "><td class="line">48</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    {or_addresses: {$elemMatch: {$regex: new RegExp('^' + query.toLowerCase()) }}},</span></td><td class="action"></td></tr><tr class="hit "><td class="line">49</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    {exit_addresses: {$elemMatch: {$regex: new RegExp('^' + query.toLowerCase()) }}}</span></td><td class="action"></td></tr><tr><td class="line">50</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                ];</span></td><td class="action"></td></tr><tr><td class="line">51</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">52</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'guard_probability', filterOptions.guards, { $gt: 0 });</span></td><td class="action"></td></tr><tr class="hit "><td class="line">53</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'flags', filterOptions.flag, filterOptions.flag);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">54</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'running', filterOptions.running, filterOptions.running);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">55</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'exit_probability', filterOptions.exit, { $gt: 0 });</span></td><td class="action"></td></tr><tr class="hit "><td class="line">56</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'as_number', filterOptions.as, filterOptions.as);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">57</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'country', filterOptions.country, filterOptions.country);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">58</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'os', filterOptions.os, {$in: filterOptions.os});</span></td><td class="action"></td></tr><tr class="hit "><td class="line">59</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'tor', filterOptions.tor, {$in: filterOptions.tor});</span></td><td class="action"></td></tr><tr class="hit "><td class="line">60</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    addToOptionIf(dbFilterOptions, 'family', filterOptions.family, function () {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">61</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return '$' + filterOptions.family.toUpperCase();</span></td><td class="action"></td></tr><tr><td class="line">62</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">63</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">64</td><td class="hits">38</td><td class="statements">100%</td><td class="source"><span class="statement ">    return dbFilterOptions;</span></td><td class="action"></td></tr><tr><td class="line">65</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/speeds.js">src/lib/db/onionoo-mongo/speeds.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">0% block coverage</div><div class="sloc">8 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = {
    FAST_EXIT: {
        // 95 Mbit/s</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        BANDWIDTH_RATE: 95 * 125 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // 5000 kB/s</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        ADVERTISED_BANDWIDTH: 5000 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        PORTS: [80, 443, 554, 1755],</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        BANDWIDTH_RATE: 95 * 125 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // 5000 kB/s</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        ADVERTISED_BANDWIDTH: 5000 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        PORTS: [80, 443, 554, 1755]</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        BANDWIDTH_RATE: 80 * 125 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // 2000 kB/s</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        ADVERTISED_BANDWIDTH: 2000 * 1024,</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        PORTS: [80, 443],</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/filters/exit-speed.js">src/lib/db/filters/exit-speed.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">27 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var assert = require('assert'),
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (items, requiredPorts) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">    assert(_.isArray(items), 'ExitSpeedFilter needs items array');</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">    return items.filter(function (relay) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        assert(relay.exit_policy_summary.hasOwnProperty('accept') || relay.exit_policy_summary.hasOwnProperty('reject'),
            'Exit policy summary has either accept or reject');</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">        var target = relay.exit_policy_summary.accept ? 'accept' : 'reject',</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">            ports = relay.exit_policy_summary['_' + target],</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">            portRanges = relay.exit_policy_summary['_' + target + '_range'],</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            portsObj = {},</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // create array with all ports</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">15</td><td class="statements">100%</td><td class="source"><span class="statement ">        for (var prI = 0, prLength = portRanges.length; prI &lt; prLength; prI++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            ports = ports.concat(_.range(portRanges[prI].start, portRanges[prI].end + 1));</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">        portsObj = ports.reduce(function (acc, key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">1344</td><td class="statements">100%</td><td class="source"><span class="statement ">            acc[key] = true;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">1344</td><td class="statements">100%</td><td class="source"><span class="statement ">            return acc;</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }, {});</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (target === 'accept') {</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // accept: check if request ports are in stored object</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">            filteredObjects = requiredPorts.every(function (key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">                return portsObj[key];</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            });</span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">            filteredObjects = requiredPorts.every(function (key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">                return !portsObj[key];</span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            });</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">        return filteredObjects;</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/filters/same-network.js">src/lib/db/filters/same-network.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">33 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var rsplit = require('../../util/rsplit'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    _ = require('lodash-node'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    logger = require('../../../../logger');</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (items, maxPerNetwork) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    var netData = {};</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // same network filter is a copy of compass.py SameNetworkFilter</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">16</td><td class="statements">100%</td><td class="source"><span class="statement ">    for (var itemIndex = 0; itemIndex &lt; items.length; itemIndex++){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        var relay = items[itemIndex];</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        var orAddresses = relay.or_addresses,
            numAddresses = 0;</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">        for (var orIndex = 0; orIndex &lt; orAddresses.length; orIndex++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">            var orAddress = orAddresses[orIndex];</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//        orAddresses.forEach(function (orAddress) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">            var split = rsplit(orAddress, ':', 1),
                ip = split[0],
                network;</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // skip if is ipv6</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (ip.indexOf(':') &gt; -1) { break; }</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            numAddresses++;</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (numAddresses &gt; 1) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                logger.info('%s has more than one IPv4 OR address - %s', relay.fingerprint, orAddresses.join(', '));</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                break;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            network = rsplit(orAddress, '.', 1)[0];</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (netData[network]) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                if (netData[network].length &gt;= maxPerNetwork) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    var minExit = relay.exit_probability,
                        minIndex = -1;</span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">32</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                    for (var netIndex = 0; netIndex &lt; netData[network].length; netIndex++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                        var value = netData[network][netIndex];</span></td><td class="action"></td></tr><tr class="hit "><td class="line">34</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                        if (value.exit_probability &lt; minExit) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">35</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                            minExit = value.exit_probability;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                            minIndex = netIndex;</span></td><td class="action"></td></tr><tr><td class="line">37</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                    if (minIndex !== -1) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">39</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                        netData[network].splice(minIndex, 1);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">                        netData[network].push(relay);</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                    netData[network].push(relay);</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">                netData[network] = [relay];</span></td><td class="action"></td></tr><tr><td class="line">45</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">46</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    return _.flatten(_.values(netData));</span></td><td class="action"></td></tr><tr><td class="line">47</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/create-sort-fn.js">src/lib/util/create-sort-fn.js</h2><div class="stats high"><div class="percentage">95% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">92% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">88% block coverage</div><div class="sloc">61 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var version = require('../util/compare-version');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var number = function (a, b) {
    /* eslint no-else-return: 0 */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1350</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (a === undefined || b === undefined) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">9</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (a === undefined &amp;&amp; b === undefined) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            return 0;</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (a === undefined &amp;&amp; b !== undefined) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            return -1;</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">            return 1;</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1341</td><td class="statements">100%</td><td class="source"><span class="statement ">    return a - b;</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Creates a sort function for numeric sorting.</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} property Property to check while sorting</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Boolean} asc If the sort function should sort ascending or descending</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {Function} Function that can be used in Array.sort</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.numeric = function (property, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">26</td><td class="statements">100%</td><td class="source"><span class="statement ">    return asc ? function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return number(a[property], b[property]);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">25</td><td class="statements">100%</td><td class="source"><span class="statement ">    } : function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">1349</td><td class="statements">100%</td><td class="source"><span class="statement ">        return number(b[property], a[property]);</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Creates a sort function.</span></td><td class="action"></td></tr><tr><td class="line">29</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} property Property to check while sorting</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Boolean} asc If the sort function should sort ascending or descending</span></td><td class="action"></td></tr><tr><td class="line">31</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {Function} Function that can be used in Array.sort</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.string = function (property, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">34</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return asc ? function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">35</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return (a[property] || '').localeCompare(b[property] || '');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    } : function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return (b[property] || '').localeCompare(a[property] || '');</span></td><td class="action"></td></tr><tr><td class="line">38</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.firstArrayEntry = function (property, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">41</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return asc ? function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">15</td><td class="statements">100%</td><td class="source"><span class="statement ">        var firstKeyA = a[property],
            firstKeyB = b[property];</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">44</td><td class="hits">15</td><td class="statements">69%</td><td class="source"><span class="statement ">        if (!firstKeyA &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>!firstKeyB</span><span class="statement ">|| !firstKeyA.length &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>!firstKeyB.length</span><span class="statement ">|| firstKeyA[0][0] === null &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>firstKeyB[0][0] === null</span><span class="statement "> {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return 0;</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">47</td><td class="hits">15</td><td class="statements">82%</td><td class="source"><span class="statement ">        if (!firstKeyA &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>firstKeyB</span><span class="statement ">|| !firstKeyA.length &amp;&amp; firstKeyB.length || firstKeyA[0][0] === null &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>firstKeyB[0][0] !== null</span><span class="statement "> {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return -1;</span></td><td class="action"></td></tr><tr><td class="line">49</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">50</td><td class="hits">15</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (firstKeyB &amp;&amp; !firstKeyB || firstKeyA.length &amp;&amp; !firstKeyB.length || firstKeyA[0][0] !== null &amp;&amp; firstKeyB[0][0] === null) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">51</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">            return 1;</span></td><td class="action"></td></tr><tr><td class="line">52</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">53</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        return firstKeyA[0][0].localeCompare(firstKeyB[0][0]);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">54</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    } : function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">55</td><td class="hits">12</td><td class="statements">100%</td><td class="source"><span class="statement ">        var firstKeyA = a[property],
            firstKeyB = b[property];</span></td><td class="action"></td></tr><tr><td class="line">56</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">58</td><td class="hits">12</td><td class="statements">77%</td><td class="source"><span class="statement ">        if (!firstKeyA &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>!firstKeyB</span><span class="statement ">|| !firstKeyA.length &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>!firstKeyB.length</span><span class="statement ">|| firstKeyA[0][0] === null &amp;&amp; firstKeyB[0][0] === null) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return 0;</span></td><td class="action"></td></tr><tr><td class="line">60</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">61</td><td class="hits">12</td><td class="statements">91%</td><td class="source"><span class="statement ">        if (!firstKeyA &amp;&amp;</span><span class="statement notok"><span class="offscreen"> not covered </span>firstKeyB</span><span class="statement ">|| !firstKeyA.length &amp;&amp; firstKeyB.length || firstKeyA[0][0] === null &amp;&amp; firstKeyB[0][0] !== null) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">62</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            return 1;</span></td><td class="action"></td></tr><tr><td class="line">63</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">64</td><td class="hits">10</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (firstKeyB &amp;&amp; !firstKeyB || firstKeyA.length &amp;&amp; !firstKeyB.length || firstKeyA[0][0] !== null &amp;&amp; firstKeyB[0][0] === null) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">65</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            return -1;</span></td><td class="action"></td></tr><tr><td class="line">66</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">67</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        return firstKeyB[0][0].localeCompare(firstKeyA[0][0]);</span></td><td class="action"></td></tr><tr><td class="line">68</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">69</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">70</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">71</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// Compare array length</span></td><td class="action"></td></tr><tr class="hit "><td class="line">72</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.arrayLength = function (property, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">73</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return asc ? function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">74</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        return a[property].length - b[property].length;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">75</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    } : function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">76</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        return b[property].length - a[property].length;</span></td><td class="action"></td></tr><tr><td class="line">77</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">78</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">79</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">80</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.version = function (property, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">81</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    return asc ? function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">82</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return version(a[property], b[property]);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">83</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    } : function (a, b) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">84</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return version(b[property], a[property]);</span></td><td class="action"></td></tr><tr><td class="line">85</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">86</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/compare-version.js">src/lib/util/compare-version.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">18 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var extractVersion = require('./extract-version');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that can be used in a array.sort() to compare 4 level version strings.</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} version1 Version 1 to compare</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} version2 Version 2 to compare</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {number} 0 if both are equal, -1 if version 1 is smaller, 1 if version 2 is smaller</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var compareVersions = function (version1, version2) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">    var v1, v2,
        compared = 0;</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    try {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">        v1 = extractVersion(version1);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">15</td><td class="statements">100%</td><td class="source"><span class="statement ">        v2 = extractVersion(version2);</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    } catch (e) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        return -1;</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">14</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (v1.major !== v2.major) {</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // compare major</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        compared = v1.major - v2.major;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">12</td><td class="statements">100%</td><td class="source"><span class="statement ">    } else if (v1.minor !== v2.minor) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        compared = v1.minor - v2.minor;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    } else if (v1.build !== v2.build) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        compared = v1.build - v2.build;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    } else if (v1.revision !== v2.revision) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        compared = v1.revision.localeCompare(v2.revision);</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">14</td><td class="statements">100%</td><td class="source"><span class="statement ">    return compared;</span></td><td class="action"></td></tr><tr><td class="line">29</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = compareVersions;</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/extract-version.js">src/lib/util/extract-version.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">12 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var assert = require('assert');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (versionString) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">34</td><td class="statements">100%</td><td class="source"><span class="statement ">    assert(typeof versionString === 'string');</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">    var version = {},
        segments = versionString.split('.');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (segments.length &gt; 0) {</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // major.minor[.build[.revision]]</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">        version.major = parseInt(segments[0], 10);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">        version.minor = parseInt(segments[1], 10);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">        version.build = parseInt(segments[2], 10);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">        version.revision = segments[3];</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">31</td><td class="statements">100%</td><td class="source"><span class="statement ">    return version;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/group.js">src/lib/db/onionoo-mongo/group.js</h2><div class="stats high"><div class="percentage">75% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">74% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">36% block coverage</div><div class="sloc">86 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/*eslint camelcase:0, no-space-before-semi: 0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var RSVP = require('rsvp'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    logger = require('../../../../logger'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    getSortType = require('../../util/get-sort-type'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    processGroupResults = require('./process-group-results'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    createMongoFilter = require('./create-mongo-filter'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    countArrayUniques = require('../../util/count-array-uniques'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    _ = require('lodash-node'),</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// filters</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    exitSpeedFilter = require('../filters/exit-speed'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    sameNetworkFilter = require('../filters/same-network'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    createSortFn = require('../../util/create-sort-fn');</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var defaultOpts = {
        sortBy: 'consensus_weight_fraction',
        sortAsc: false,
        displayAmount: 10,
        group: {},
        filter: {
            exitSpeed: null,
            running: null,
            guards: null,
            exit: null,
            family: null,
            as: null,
            country: null,
            speed: null
        }
    },
    countItemsToObject = function (arr) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">315</td><td class="statements">100%</td><td class="source"><span class="statement ">        return countArrayUniques(arr);</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//        var obj = new Map();</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.as_name = countItemsToObject(relay.as_name);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.as_number = countItemsToObject(relay.as_number);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.country = countItemsToObject(relay.country);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.contact = countItemsToObject(relay.contact);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.tor = countItemsToObject(relay.tor);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        relay.os = countItemsToObject(relay.os);</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">24</td><td class="hits">45</td><td class="statements">80%</td><td class="source"><span class="statement ">        relay.family = countItemsToObject(isGroupFamily ?</span><span class="statement notok"><span class="offscreen"> not covered </span>relay.family</span><span class="statement ">: _.flatten(relay.family));</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">        return relay;</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (collections, methodOpts) {
//    var startHrtime = process.hrtime();
</span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    var opts = _.merge({}, defaultOpts, methodOpts),
        filterOpts = opts.filter,
        groupFields = {},
        aggregatePromise,
        aggregatePipe = [],
</span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        hasExitSpeedFilter = filterOpts.exitSpeed !== null,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">32</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        hasSameNetworkFilter = hasExitSpeedFilter &amp;&amp; filterOpts.exitSpeed.MAX_PER_NETWORK,</span></td><td class="action"></td></tr><tr><td class="line">33</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        hasGroupCountry = opts.group.country,</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        hasGroupAS = opts.group.as,</span></td><td class="action"></td></tr><tr><td class="line">36</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        hasGroupContact = opts.group.contact,</span></td><td class="action"></td></tr><tr><td class="line">37</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        hasGroupFamily = opts.group.family,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        hasGroupAnything = hasGroupAS || hasGroupContact || hasGroupCountry || hasGroupFamily,</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">40</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        sortObj = {},</span></td><td class="action"></td></tr><tr class="hit "><td class="line">41</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        dbOpts = createMongoFilter(filterOpts),</span></td><td class="action"></td></tr><tr><td class="line">42</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        relays = collections.relays,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">43</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        sortFnType = getSortType(opts.sortBy),</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">44</td><td class="hits">8</td><td class="statements">67%</td><td class="source"><span class="statement ">        sortFn = (createSortFn[sortFnType] ? createSortFn[sortFnType] :</span><span class="statement notok"><span class="offscreen"> not covered </span>createSortFn.numeric</span><span class="statement ">(opts.sortBy, opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">45</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // change sort functions for some special cases</span></td><td class="action"></td></tr><tr><td class="line">47</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    switch (opts.sortBy) {</span></td><td class="action"></td></tr><tr><td class="line">48</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        case 'os':</span></td><td class="action"></td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupAnything) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('os', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">51</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupAnything) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('tor', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">54</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupFamily) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.firstArrayEntry('family', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('family', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">59</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupContact) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">61</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.firstArrayEntry('contact', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">62</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">63</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('contact', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">64</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">65</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (hasGroupCountry) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">66</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                sortFn = createSortFn.firstArrayEntry('country', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">67</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('country', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">69</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupAnything) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('fingerprints', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">72</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            if (hasGroupAS) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.firstArrayEntry('as_number', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">75</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">76</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn = createSortFn.arrayLength('as_number', opts.sortAsc);</span></td><td class="action"></td></tr><tr><td class="line">77</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">78</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasGroupAS) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">79</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        groupFields.as_number = '$as_number';</span></td><td class="action"></td></tr><tr><td class="line">80</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">81</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasGroupCountry) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">82</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        groupFields.country = '$country';</span></td><td class="action"></td></tr><tr><td class="line">83</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">84</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasGroupContact) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        groupFields.contact = '$contact';</span></td><td class="action"></td></tr><tr><td class="line">86</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">87</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasGroupFamily) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        groupFields.family = '$family';</span></td><td class="action"></td></tr><tr><td class="line">89</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">90</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    sortObj[opts.sortBy] = opts.sortAsc ? 1 : -1;</span></td><td class="action"></td></tr><tr><td class="line">91</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">92</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // build the aggregate pipeline</span></td><td class="action"></td></tr><tr><td class="line">93</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // match via filter options</span></td><td class="action"></td></tr><tr class="hit "><td class="line">94</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    aggregatePipe.push({$match: dbOpts});</span></td><td class="action"></td></tr><tr><td class="line">95</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">96</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (hasGroupFamily) {</span></td><td class="action"></td></tr><tr><td class="line">97</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // if group by family, unwind family array</span></td><td class="action"></td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        aggregatePipe.push({$unwind: '$family'});</span></td><td class="action"></td></tr><tr><td class="line">99</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">100</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    aggregatePipe.push({
        $group: {
            _id: groupFields,
            fingerprints: { $push: '$$ROOT' },
            consensus_weight_fraction: {$sum: '$consensus_weight_fraction'},
            advertised_bandwidth_fraction: {$sum: '$advertised_bandwidth_fraction'},
            guard_probability: {$sum: '$guard_probability'},
            middle_probability: {$sum: '$middle_probability'},
            exit_probability: {$sum: '$exit_probability'},
            as_number: { $push: '$as_number' },
            as_name: { $push: '$as_name' },
            country: { $push: '$country' },
            contact: { $push: '$contact' },
            tor: { $push: '$tor' },
            os: { $push: '$os' },
            family: {$push: '$family'}
        }
    });</span></td><td class="action"></td></tr><tr><td class="line">101</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">102</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // create promise that aggregates using created pipeline</span></td><td class="action"></td></tr><tr class="hit "><td class="line">103</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    aggregatePromise = new RSVP.Promise(function (resolve) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">104</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        var resultData = [],</span></td><td class="action"></td></tr><tr class="hit "><td class="line">105</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            });</span></td><td class="action"></td></tr><tr><td class="line">106</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                cursor: {batchSize: 1000}</span></td><td class="action"></td></tr><tr class="hit "><td class="line">107</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            });</span></td><td class="action"></td></tr><tr class="hit "><td class="line">108</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        cursor.on('data', function (data) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">109</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">            resultData.push(beforeCheck(data, hasGroupFamily));</span></td><td class="action"></td></tr><tr><td class="line">110</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr class="hit "><td class="line">111</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        cursor.on('end', function () {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">112</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            resolve({
                relays: resultData
            });</span></td><td class="action"></td></tr><tr><td class="line">113</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                relays: resultData</span></td><td class="action"></td></tr><tr><td class="line">114</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }).then(function (results) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">115</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            var filteredRelays = results.relays;</span></td><td class="action"></td></tr><tr><td class="line">116</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">117</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (hasExitSpeedFilter) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                filteredRelays = exitSpeedFilter(filteredRelays, filterOpts.exitSpeed.PORTS);</span></td><td class="action"></td></tr><tr><td class="line">119</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">120</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (hasSameNetworkFilter) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                filteredRelays = sameNetworkFilter(filteredRelays, filterOpts.exitSpeed.MAX_PER_NETWORK);</span></td><td class="action"></td></tr><tr><td class="line">122</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr><td class="line">123</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return processGroupResults({</span></td><td class="action"></td></tr><tr><td class="line">124</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                sortFn: sortFn,</span></td><td class="action"></td></tr><tr><td class="line">125</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                displayLimit: opts.displayAmount,</span></td><td class="action"></td></tr><tr><td class="line">126</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                relays: filteredRelays,</span></td><td class="action"></td></tr><tr><td class="line">127</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                bridges: []</span></td><td class="action"></td></tr><tr class="hit "><td class="line">128</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            }).then(function (processedResults) {</span></td><td class="action"></td></tr><tr><td class="line">129</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//                var diff = process.hrtime(startHrtime);</span></td><td class="action"></td></tr><tr><td class="line">130</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//                logger.info('group took %d nanoseconds', diff[0] * 1e9 + diff[1]);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">131</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">                processedResults.uiFlags = {
                    hasCountryFlags: hasGroupCountry,
                    hasGroupAS: hasGroupAS,
                    hasGroupContact: hasGroupContact,
                    hasGroupFamily: hasGroupFamily
                };</span></td><td class="action"></td></tr><tr class="hit "><td class="line">132</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">                return processedResults;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">133</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">            });</span></td><td class="action"></td></tr><tr><td class="line">134</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr><td class="line">135</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">136</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    return aggregatePromise;</span></td><td class="action"></td></tr><tr><td class="line">137</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/db/onionoo-mongo/process-group-results.js">src/lib/db/onionoo-mongo/process-group-results.js</h2><div class="stats high"><div class="percentage">81% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">83% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">54% block coverage</div><div class="sloc">32 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/* eslint camelcase:0 */</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var RSVP = require('rsvp'),
    _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (filterResults) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isArray(filterResults.relays)) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">7</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        filterResults.relays = [];</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isArray(filterResults.bridges)) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        filterResults.bridges = [];</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!_.isFunction(filterResults.sortFn)) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">13</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        filterResults.sortFn = function (a, b) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            return b.consensus_weight_fraction - a.consensus_weight_fraction;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        };</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    return new RSVP.Promise(function (resolve) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        var relay,
            displayed = {
                relays: [],
                bridges: []
            },
            displayLimit = filterResults.displayLimit,
            notDisplayed = {
                relays: {
                    number: 0,
                    consensus_weight_fraction: 0,
                    advertised_bandwidth_fraction: 0,
                    guard_probability: 0,
                    middle_probability: 0,
                    exit_probability: 0,
                    tor: 0,
                    os: 0
                },
                bridges: {}
            };</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (displayLimit &lt;= 0) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            displayLimit = filterResults.relays.length;</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">23</td><td class="hits">20</td><td class="statements">100%</td><td class="source"><span class="statement ">            return val !== null &amp;&amp; val !== undefined &amp;&amp; val !== -1;</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        filterResults.relays = filterResults.relays.sort(filterResults.sortFn);</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // generate aggregated filterResults</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">53</td><td class="statements">100%</td><td class="source"><span class="statement ">        for (var index = 0, max = filterResults.relays.length; index &lt; max; index++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">            relay = filterResults.relays[index];</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">45</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (index &gt;= displayLimit) {</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                // is not displayed</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">                notDisplayed.relays.number++;</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">34</td><td class="hits">4</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.consensus_weight_fraction += canAdd(relay.consensus_weight_fraction) ? relay.consensus_weight_fraction :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">35</td><td class="hits">4</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.advertised_bandwidth_fraction += canAdd(relay.advertised_bandwidth_fraction) ? relay.advertised_bandwidth_fraction :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">36</td><td class="hits">4</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.guard_probability += canAdd(relay.guard_probability) ? relay.guard_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">37</td><td class="hits">4</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.middle_probability += canAdd(relay.middle_probability) ? relay.middle_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">38</td><td class="hits">4</td><td class="statements">75%</td><td class="source"><span class="statement ">                notDisplayed.relays.exit_probability += canAdd(relay.exit_probability) ? relay.exit_probability :</span><span class="statement notok"><span class="offscreen"> not covered </span>0</span><span class="statement "></span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">41</td><td class="statements">100%</td><td class="source"><span class="statement ">                displayed.relays.push(relay);</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">        resolve({
            notDisplayed: notDisplayed,
            displayed: displayed,
            numBridges: filterResults.bridges.length,
            numRelays: filterResults.relays.length
        });</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    });</span></td><td class="action"></td></tr><tr><td class="line">44</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/count-array-uniques.js">src/lib/util/count-array-uniques.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">15 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function to reduce an array and count the occurrences of each item.</span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Do not use an array with anything other than string or null elements with this function.</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * It is only works correctly with strings and null.</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Note:</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * This function will be replaced (when it's done) with an ES6 Map implementation.</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @example:</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *      var obj = new Map();</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *      arr.forEach(function (item) {</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *          obj.set(item, obj.has(item) ? obj.get(item) + 1 : 1);</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *      });</span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *      return obj;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @see https://groups.google.com/forum/#!topic/v8-users/T-LgdSosMJ8</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> *</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @via https://gist.github.com/ralphcrisostomo/3141412</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Array} array Array to use</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @returns {Array} Array of unique counted items</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (array) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">317</td><td class="statements">100%</td><td class="source"><span class="statement ">    var obj = {},
        el = '',
        nulls = 0;</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // count all unique elements</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">798</td><td class="statements">100%</td><td class="source"><span class="statement ">    for (var i = 0, length = array.length; i &lt; length; i++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">481</td><td class="statements">100%</td><td class="source"><span class="statement ">        el = array[i];</span></td><td class="action"></td></tr><tr class="hit "><td class="line">27</td><td class="hits">481</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (el !== null) {</span></td><td class="action"></td></tr><tr><td class="line">28</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            // if not null add to object</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">393</td><td class="statements">100%</td><td class="source"><span class="statement ">            obj[el] = (obj[el] || 0) + 1;</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">88</td><td class="statements">100%</td><td class="source"><span class="statement ">            nulls++;</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">317</td><td class="statements">100%</td><td class="source"><span class="statement ">    var keys = Object.keys(obj),
        len = keys.length,
        j,
    // put null in</span></td><td class="action"></td></tr><tr class="hit "><td class="line">34</td><td class="hits">317</td><td class="statements">100%</td><td class="source"><span class="statement ">        countedArray = nulls &gt; 0 ? [
            [null, nulls]
        ] : [];</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            [null, nulls]</span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">317</td><td class="statements">100%</td><td class="source"><span class="statement ">        ] : [];</span></td><td class="action"></td></tr><tr><td class="line">37</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">38</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // iterate over created object</span></td><td class="action"></td></tr><tr class="hit "><td class="line">39</td><td class="hits">664</td><td class="statements">100%</td><td class="source"><span class="statement ">    for (j = 0; j &lt; len; j++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">347</td><td class="statements">100%</td><td class="source"><span class="statement ">        countedArray.push([keys[j], obj[keys[j]]]);</span></td><td class="action"></td></tr><tr><td class="line">41</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">317</td><td class="statements">100%</td><td class="source"><span class="statement ">    return countedArray;</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/formatter.js">src/lib/util/formatter.js</h2><div class="stats high"><div class="percentage">94% line coverage<a href="#miss0"> go <span class="offscreen">jump to first missed line</span></a></div><div class="statements">97% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">87% block coverage</div><div class="sloc">109 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>// TODO: xss escape</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    querystring = require('querystring'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    errors = require('../errors'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    is40CharHex = require('./../onionoo/util/is-fingerprint'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    uptimeCalculator = require('./calculate-uptime'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    countryFlag = require('./country-flag'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    globals = require('../global-data');</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.uptimeFull = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return '';</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    var uptimeArray = uptimeCalculator(value, 'long');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    return uptimeArray.join(' ');</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.uptimeShort = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        return '';</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    var uptimeArray = uptimeCalculator(value, 'short');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    return uptimeArray.join(' ');</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">24</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.port = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    var port = '';</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (typeof value === 'string') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        var parts = value.split(':');</span></td><td class="action"></td></tr><tr class="hit "><td class="line">30</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (parts.length === 2 &amp;&amp; parts[1].length) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">31</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            port = parts[1];</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">8</td><td class="statements">100%</td><td class="source"><span class="statement ">    return port;</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.bandwidth = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">    var formatted = '';</span></td><td class="action"></td></tr><tr><td class="line">38</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">39</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">    value = parseInt(value, 10);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">40</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (value !== -1 &amp;&amp; !isNaN(value)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">41</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">        var bandwidthKB = value / 1000;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">42</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">        var bandwidthMB = bandwidthKB / 1000;</span></td><td class="action"></td></tr><tr><td class="line">43</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (bandwidthMB &gt;= 1) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            formatted = Math.round(bandwidthMB * 100) / 100 + ' MB/s';</span></td><td class="action"></td></tr><tr><td class="line">46</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">47</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (bandwidthKB &gt;= 1) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">48</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                formatted = Math.round(bandwidthKB * 100) / 100 + ' kB/s';</span></td><td class="action"></td></tr><tr><td class="line">49</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">50</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">                formatted = value + ' B/s';</span></td><td class="action"></td></tr><tr><td class="line">51</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">52</td><td class="hits">11</td><td class="statements">100%</td><td class="source"><span class="statement ">    return formatted;</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">54</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">55</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.propFlag = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">56</td><td class="hits">16</td><td class="statements">100%</td><td class="source"><span class="statement ">    var map = globals.icons,
        withImage = '';</span></td><td class="action"></td></tr><tr><td class="line">57</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">58</td><td class="hits">16</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (map.hasOwnProperty(value)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">59</td><td class="hits">14</td><td class="statements">100%</td><td class="source"><span class="statement ">        withImage = '&lt;span class=&quot;fa ' + map[value] + '&quot; title=&quot;' + value + '&quot;&gt;&lt;/span&gt;';</span></td><td class="action"></td></tr><tr><td class="line">60</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">61</td><td class="hits">16</td><td class="statements">100%</td><td class="source"><span class="statement ">    return withImage;</span></td><td class="action"></td></tr><tr><td class="line">62</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">63</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">64</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.onionFlags = function (data) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">65</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    var flagString = '';</span></td><td class="action"></td></tr><tr><td class="line">66</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">67</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // check if data is not empty array</span></td><td class="action"></td></tr><tr class="hit "><td class="line">68</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!(_.isArray(data) &amp;&amp; data.length)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">69</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        return '';</span></td><td class="action"></td></tr><tr><td class="line">70</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">71</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    for (var dataIndex = 0; dataIndex &lt; data.length; dataIndex++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">72</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        flagString += exports.propFlag(data[dataIndex]);</span></td><td class="action"></td></tr><tr><td class="line">73</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">74</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    return flagString;</span></td><td class="action"></td></tr><tr><td class="line">75</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">76</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">77</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.flaggify = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">78</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    return countryFlag(value);</span></td><td class="action"></td></tr><tr><td class="line">79</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">80</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">81</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">82</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">83</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Returns the fingerprint from a detail document family member</span></td><td class="action"></td></tr><tr><td class="line">84</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @see {@link https://onionoo.torproject.org/#details}</span></td><td class="action"></td></tr><tr><td class="line">85</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} val family member</span></td><td class="action"></td></tr><tr><td class="line">86</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @returns {String} empty or fingerprint</span></td><td class="action"></td></tr><tr><td class="line">87</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @example</span></td><td class="action"></td></tr><tr><td class="line">88</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * // returns '0000000000000000000000000000000000000000'</span></td><td class="action"></td></tr><tr><td class="line">89</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * GLOBE.Formatter.familyToFingerprint('$0000000000000000000000000000000000000000')</span></td><td class="action"></td></tr><tr><td class="line">90</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">91</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.familyToFingerprint = function (val) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">92</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    var fingerprint = '';</span></td><td class="action"></td></tr><tr><td class="line">93</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">94</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    // check if value is a string and begins with $</span></td><td class="action"></td></tr><tr class="hit "><td class="line">95</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (_.isString(val) &amp;&amp; val.indexOf('$') === 0) {</span></td><td class="action"></td></tr><tr><td class="line">96</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // strip $ from value</span></td><td class="action"></td></tr><tr class="hit "><td class="line">97</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        fingerprint = val.slice(1);</span></td><td class="action"></td></tr><tr><td class="line">98</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">99</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!is40CharHex(fingerprint)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">100</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        throw errors.NotA40CharHexString;</span></td><td class="action"></td></tr><tr><td class="line">101</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">102</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    return fingerprint;</span></td><td class="action"></td></tr><tr><td class="line">103</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">104</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">105</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.percent = function (val, precision) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">106</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    var fixed = '';</span></td><td class="action"></td></tr><tr class="hit "><td class="line">107</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    precision = precision || 2;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">108</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!isNaN(val) &amp;&amp; typeof val === 'number') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">109</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        fixed = (val * 100).toFixed(precision) + '%';</span></td><td class="action"></td></tr><tr><td class="line">110</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">111</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    return fixed;</span></td><td class="action"></td></tr><tr><td class="line">112</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">113</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">114</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">115</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that generates a sort query with a given query object and field that should be used to sort.</span></td><td class="action"></td></tr><tr><td class="line">116</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} query Query object</span></td><td class="action"></td></tr><tr><td class="line">117</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} field Field to sort</span></td><td class="action"></td></tr><tr><td class="line">118</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {String} Created querystring</span></td><td class="action"></td></tr><tr><td class="line">119</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">120</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.searchQuery = function (query, field) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">121</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    var queryClone = _.clone(query),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">122</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        invert = queryClone.sortBy === field,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">123</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        sortAsc = queryClone.sortAsc === 'true' || queryClone.sortAsc === true;</span></td><td class="action"></td></tr><tr><td class="line">124</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">125</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    queryClone.sortBy = field;</span></td><td class="action"></td></tr><tr><td class="line">126</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">127</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (invert) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">128</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        queryClone.sortAsc = '' + !sortAsc;</span></td><td class="action"></td></tr><tr><td class="line">129</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">130</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        queryClone.sortAsc = 'false';</span></td><td class="action"></td></tr><tr><td class="line">131</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">132</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        queryClone['os[]'] = queryClone.os;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">133</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        delete queryClone.os;</span></td><td class="action"></td></tr><tr><td class="line">134</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">135</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        queryClone['tor[]'] = queryClone.tor;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">136</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        delete queryClone.tor;</span></td><td class="action"></td></tr><tr><td class="line">137</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">138</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    return querystring.stringify(queryClone);</span></td><td class="action"></td></tr><tr><td class="line">139</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">140</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">141</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">142</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function to build a url to search for all items in a given group based on grouped by object</span></td><td class="action"></td></tr><tr><td class="line">143</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} groupedBy Group by flags</span></td><td class="action"></td></tr><tr><td class="line">144</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Array} group Group content</span></td><td class="action"></td></tr><tr><td class="line">145</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} query Search query</span></td><td class="action"></td></tr><tr><td class="line">146</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {string} Url</span></td><td class="action"></td></tr><tr><td class="line">147</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">148</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.buildSearchQuery = function (groupedBy, group, query) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">149</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    var searchQuery = [];</span></td><td class="action"></td></tr><tr><td class="line">150</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">151</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (typeof query === 'string') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">152</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        searchQuery.push('query=' + query);</span></td><td class="action"></td></tr><tr><td class="line">153</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">154</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        searchQuery.push('as=' + group.as_number[0][0]);</span></td><td class="action"></td></tr><tr><td class="line">155</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">156</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        searchQuery.push('country=' + group.country[0][0]);</span></td><td class="action"></td></tr><tr><td class="line">157</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">158</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        searchQuery.push('contact=' + group.contact[0][0]);</span></td><td class="action"></td></tr><tr><td class="line">159</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">160</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        searchQuery.push('family=' + group.family[0][0]);</span></td><td class="action"></td></tr><tr><td class="line">161</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">162</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    return '/search-compass?limit=10&amp;' + searchQuery.join('&amp;');</span></td><td class="action"></td></tr><tr><td class="line">163</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">164</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">165</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.sortIndicator = function (type, asc) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">166</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    type = type || 'amount';</span></td><td class="action"></td></tr><tr><td class="line">167</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">168</td><td class="hits">6</td><td class="statements">100%</td><td class="source"><span class="statement ">    return '&lt;i class=&quot;fa fa-sort-' + type + '-' + (asc ? 'asc' : 'desc') + '&quot;&gt;&lt;/i&gt;';</span></td><td class="action"></td></tr><tr><td class="line">169</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr><tr><td class="line">170</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">171</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">exports.groupFlagList = function (groupFlags) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">172</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    var list = '';</span></td><td class="action"></td></tr><tr><td class="line">173</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    if (groupFlags.hasCountryFlags) {</span></td><td class="action"></td></tr><tr class="miss"><td class="line">174</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        list += 'country ';</span></td><td class="action"></td></tr><tr><td class="line">175</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        list += 'as number ';</span></td><td class="action"></td></tr><tr><td class="line">177</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">178</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        list += 'contact ';</span></td><td class="action"></td></tr><tr><td class="line">179</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        list += 'family ';</span></td><td class="action"></td></tr><tr><td class="line">181</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="miss"><td class="line">182</td><td class="hits">0</td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    return list;</span></td><td class="action"></td></tr><tr><td class="line">183</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/errors.js">src/lib/errors.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">0% block coverage</div><div class="sloc">4 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node'),
    OnionooErrors = require('./onionoo/errors');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = _.merge({
    RelayNotFound: 'Couldn\'t find requested relay.',
    BridgeNotFound: 'Couldn\'t find requested bridge.'
}, OnionooErrors);</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/onionoo/errors.js">src/lib/onionoo/errors.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">0% block coverage</div><div class="sloc">2 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = {
    NotA40CharHexString: 'Function expects a 40 char hex string.'
};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/onionoo/util/is-fingerprint.js">src/lib/onionoo/util/is-fingerprint.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">8 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(value){</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">22</td><td class="statements">100%</td><td class="source"><span class="statement ">    var hex40CharRegex = /^[a-f0-9]{40}/i,
        result;</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">22</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (_.isString(value)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">14</td><td class="statements">100%</td><td class="source"><span class="statement ">        result = value.match(hex40CharRegex);</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">22</td><td class="statements">100%</td><td class="source"><span class="statement ">    return !!result;</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/middleware/feature-flags.js">src/lib/middleware/feature-flags.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">96% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">100% block coverage</div><div class="sloc">13 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Function that returns a middleware that parses the `features` url parameter and enables the corresponding.</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Object} features Map of enabled/disabled feature identifier.</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {Function} Middleware to parse features url parameter.</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (features) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    return function (req, res, next) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        var paramFeatures = req.param('features', ''),</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">11</td><td class="hits">2</td><td class="statements">67%</td><td class="source"><span class="statement ">            paramFeaturesArray = paramFeatures ? paramFeatures.split(',') :</span><span class="statement notok"><span class="offscreen"> not covered </span>[]</span><span class="statement "></span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>            reqFeatures = {};</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">14</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        _.forIn(features, function (value, key) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            reqFeatures[key] = paramFeaturesArray.indexOf(key) !== -1 ? true : value;</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        });</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        req.features = reqFeatures;</span></td><td class="action"></td></tr><tr><td class="line">20</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">21</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        next();</span></td><td class="action"></td></tr><tr><td class="line">22</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/middleware/handle404.js">src/lib/middleware/handle404.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">14 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function () {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    return function (req, res) {
        // set response status to 404</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        res.status(404);</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        // respond with html page</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (req.accepts('html')) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">7</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            res.render('error', {
                title: 404,
                msg: 'Resource not found'
            });</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                title: 404,</span></td><td class="action"></td></tr><tr class="hit "><td class="line">9</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            return;</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (req.accepts('json')) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            res.send({
                error: 'Resource not found'
            });</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                error: 'Resource not found'</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            return;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        res.type('txt').send('Resource not found');</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/middleware/normalize-query.js">src/lib/middleware/normalize-query.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">98% statement coverage<a href="#partial0"> go <span class="offscreen">jump to first missed statement</span></a></div><div class="blocks">100% block coverage</div><div class="sloc">37 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var checkbox = function (value) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">4</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        var normalized = null;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (value !== null &amp;&amp; value !== undefined &amp;&amp; _.isString(value)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            normalized = value === 'on';</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">8</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        return normalized;</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr><tr class="hit "><td class="line">10</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        var normalized = value;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (value === undefined || value === '') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            normalized = null;</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        return normalized;</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        var normalized = null;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (typeof value === 'boolean') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            normalized = value;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">19</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        } else if (typeof value === 'string' &amp;&amp; value !== '') {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            normalized = value === 'true';</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        return normalized;</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        var parsed = parseInt(value, 10);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">25</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">        return isNaN(parsed) ? null : parsed;</span></td><td class="action"></td></tr><tr><td class="line">26</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr><tr class="hit "><td class="line">27</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        var array;</span></td><td class="action"></td></tr><tr class="hit "><td class="line">28</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (!_.isArray(param)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">29</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            array =  data.defaultsTo;</span></td><td class="action"></td></tr><tr><td class="line">30</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit partial"><td class="line">31</td><td class="hits">1</td><td class="statements">67%</td><td class="source"><span class="statement ">            array = param.length ?</span><span class="statement notok"><span class="offscreen"> not covered </span>param</span><span class="statement ">: data.defaultsTo;</span></td><td class="action"></td></tr><tr><td class="line">32</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">33</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        return array;</span></td><td class="action"></td></tr><tr><td class="line">34</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    },</span></td><td class="action"></td></tr><tr><td class="line">35</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">36</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (mapping) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">37</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    return function (req, res, next) {
        // if no normquery is set use query as base</span></td><td class="action"></td></tr><tr class="hit "><td class="line">38</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        req.normQuery = req.normQuery || _.clone(req.query);</span></td><td class="action"></td></tr><tr><td class="line">39</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">40</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        for (var type in mapping) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">41</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">            if (mapping.hasOwnProperty(type) &amp;&amp; mappings.hasOwnProperty(type)) {</span></td><td class="action"></td></tr><tr><td class="line">42</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>//                mapping[type].forEach(function (val) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">43</td><td class="hits">22</td><td class="statements">100%</td><td class="source"><span class="statement ">                for(var mappingIndex = 0; mappingIndex &lt; mapping[type].length; mappingIndex++) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">44</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">                    var val = mapping[type][mappingIndex];</span></td><td class="action"></td></tr><tr class="hit "><td class="line">45</td><td class="hits">17</td><td class="statements">100%</td><td class="source"><span class="statement ">                    if (_.isString(val)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">46</td><td class="hits">15</td><td class="statements">100%</td><td class="source"><span class="statement ">                        req.normQuery[val] = mappings[type](req.query[val]);</span></td><td class="action"></td></tr><tr class="hit "><td class="line">47</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                    } else if (_.isObject(val)) {</span></td><td class="action"></td></tr><tr><td class="line">48</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                        // is object that uses the `param` field for assignment</span></td><td class="action"></td></tr><tr class="hit "><td class="line">49</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">                        req.normQuery[val.param] = mappings[type](req.query[val.param], val);</span></td><td class="action"></td></tr><tr><td class="line">50</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>                    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">51</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">        next();</span></td><td class="action"></td></tr><tr><td class="line">52</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    };</span></td><td class="action"></td></tr><tr><td class="line">53</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/middleware/render-if.js">src/lib/middleware/render-if.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">8 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var _ = require('lodash-node');</span></td><td class="action"></td></tr><tr><td class="line">2</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">3</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Middleware that calls a function to determine if it should render a view and exit or</span></td><td class="action"></td></tr><tr><td class="line">5</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * pass the request to the next middleware/handler.</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {Function} checkFn Function to call</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} render View name</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {*} data Data to pass to rendered view</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @return {Function} Middleware function</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">11</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (checkFn, render, data) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">12</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">    return function (req, res, next) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">13</td><td class="hits">3</td><td class="statements">100%</td><td class="source"><span class="statement ">        if (checkFn()) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">            res.render(render, _.isFunction(data) ? data() : data);</span></td><td class="action"></td></tr><tr><td class="line">15</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">16</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">            next();</span></td><td class="action"></td></tr><tr><td class="line">17</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>        }</span></td><td class="action"></td></tr><tr><td class="line">18</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/onionoo/util/hash-fingerprint.js">src/lib/onionoo/util/hash-fingerprint.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">14 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var crypto = require('crypto'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    errors = require('../errors'),</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">    is40CharHex = require('./is-fingerprint');</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">var sha1;</span></td><td class="action"></td></tr><tr><td class="line">6</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>/**</span></td><td class="action"></td></tr><tr><td class="line">8</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * Hashes a fingerprint by converting the fingerprint to hex, to binary, apply SHA1, convert back to hex.</span></td><td class="action"></td></tr><tr><td class="line">9</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @see {@link https://trac.torproject.org/projects/tor/ticket/6320#comment:1}</span></td><td class="action"></td></tr><tr><td class="line">10</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @param {String} fingerprint Fingerprint to hash.</span></td><td class="action"></td></tr><tr><td class="line">11</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @returns {String} hashed uppercase fingerprint</span></td><td class="action"></td></tr><tr><td class="line">12</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> * @throws {errors.NotA40CharHexString}</span></td><td class="action"></td></tr><tr><td class="line">13</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span> */</span></td><td class="action"></td></tr><tr class="hit "><td class="line">14</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function(fingerprint) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">15</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    var hashed = '';</span></td><td class="action"></td></tr><tr><td class="line">16</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">17</td><td class="hits">7</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (is40CharHex(fingerprint)) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">18</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        sha1 = crypto.createHash('sha1');</span></td><td class="action"></td></tr><tr><td class="line">19</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">20</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        var buf = new Buffer(fingerprint, 'hex'),
            fingerBin = sha1.update(buf.toString('binary'));</span></td><td class="action"></td></tr><tr><td class="line">21</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span></span></td><td class="action"></td></tr><tr class="hit "><td class="line">22</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        hashed = fingerBin.digest('hex');</span></td><td class="action"></td></tr><tr><td class="line">23</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    } else {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">24</td><td class="hits">5</td><td class="statements">100%</td><td class="source"><span class="statement ">        throw errors.NotA40CharHexString + ' Got ' + fingerprint;</span></td><td class="action"></td></tr><tr><td class="line">25</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">26</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    return hashed.toUpperCase();</span></td><td class="action"></td></tr><tr><td class="line">27</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div><div class="file"><h2 id="src/lib/util/handle-sort-undefined.js">src/lib/util/handle-sort-undefined.js</h2><div class="stats high"><div class="percentage">100% line coverage</div><div class="statements">100% statement coverage</div><div class="blocks">100% block coverage</div><div class="sloc">6 SLOC</div><div class="hits"></div><div class="misses"></div></div><div class="table"><table class="source"><thead><tr><th>Line</th><th>Hits</th><th>Statements</th><th>Source</th><th>Action</th></tr></thead><tbody><tr class="hit "><td class="line">1</td><td class="hits">1</td><td class="statements">100%</td><td class="source"><span class="statement ">module.exports = function (array) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">2</td><td class="hits">4</td><td class="statements">100%</td><td class="source"><span class="statement ">    if (!array.length || array[array.length - 1] !== undefined) {</span></td><td class="action"></td></tr><tr class="hit "><td class="line">3</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">        return array;</span></td><td class="action"></td></tr><tr><td class="line">4</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>    }</span></td><td class="action"></td></tr><tr class="hit "><td class="line">5</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    var undefinedArray = array.splice(array.indexOf(undefined));</span></td><td class="action"></td></tr><tr class="hit "><td class="line">6</td><td class="hits">2</td><td class="statements">100%</td><td class="source"><span class="statement ">    return undefinedArray.concat(array);</span></td><td class="action"></td></tr><tr><td class="line">7</td><td class="hits"></td><td class="statements"></td><td class="source"><span class="statement notok"><span class="offscreen"> not covered </span>};</span></td><td class="action"></td></tr></tbody></table></div></div></div></div></body></html>